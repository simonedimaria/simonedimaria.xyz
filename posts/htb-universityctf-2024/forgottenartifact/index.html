<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>HTB University CTF 2024 - ForgottenArtifact [Author Writeup] &#183; simonedimaria's blog</title><meta name=title content="HTB University CTF 2024 - ForgottenArtifact [Author Writeup] &#183; simonedimaria's blog"><meta name=description content='Author writeup for the "ForgottenArtifact" easy blockchain challenge from HTB University CTF 2024.'><meta name=keywords content="authored,EVM,storage,"><link rel=canonical href=https://simonedimaria.xyz/posts/htb-universityctf-2024/forgottenartifact/><meta name=author content="simonedimaria"><link href=https://x.com/dimariasimone rel=me><link href=https://github.com/simonedimaria rel=me><meta property="og:url" content="https://simonedimaria.xyz/posts/htb-universityctf-2024/forgottenartifact/"><meta property="og:site_name" content="simonedimaria's blog"><meta property="og:title" content="HTB University CTF 2024 - ForgottenArtifact [Author Writeup]"><meta property="og:description" content="Author writeup for the â€œForgottenArtifactâ€ easy blockchain challenge from HTB University CTF 2024."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-05T00:00:02+01:00"><meta property="article:modified_time" content="2024-12-05T00:00:02+01:00"><meta property="article:tag" content="Authored"><meta property="article:tag" content="EVM"><meta property="article:tag" content="Storage"><meta property="og:image" content="https://simonedimaria.xyz/posts/htb-universityctf-2024/forgottenartifact/featured_htbunictf_banner.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simonedimaria.xyz/posts/htb-universityctf-2024/forgottenartifact/featured_htbunictf_banner.png"><meta name=twitter:title content="HTB University CTF 2024 - ForgottenArtifact [Author Writeup]"><meta name=twitter:description content="Author writeup for the â€œForgottenArtifactâ€ easy blockchain challenge from HTB University CTF 2024."><link type=text/css rel=stylesheet href=/css/main.bundle.min.952cc647d4f186c59ed07b5684e5ff442e04b033940e76cd8eba3a6c51251b07588d9c7b14636937cbde18a1ba69be3b8055148a0d1e2e6c17c46d564fb6ecbf.css integrity="sha512-lSzGR9TxhsWe0HtWhOX/RC4EsDOUDnbNjro6bFElGwdYjZx7FGNpN8veGKG6ab47gFUUig0eLmwXxG1WT7bsvw=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script type=text/javascript src=/js/zen-mode.min.9814dee9614d32aeb56239d118edfe20acd6231424f9b19c2dd48835038414130a5e946c0d1c9087d60e60e31840c9babfd217e3d4b95643dc8d651a71ccdf4a.js integrity="sha512-mBTe6WFNMq61YjnRGO3+IKzWIxQk+bGcLdSINQOEFBMKXpRsDRyQh9YOYOMYQMm6v9IX49S5VkPcjWUacczfSg=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP+pSqMXxm6JPOUeAg==" data-copy=Copy data-copied=Copied></script><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"HTB University CTF 2024 - ForgottenArtifact [Author Writeup]","headline":"HTB University CTF 2024 - ForgottenArtifact [Author Writeup]","abstract":"Author writeup for the \u0026ldquo;ForgottenArtifact\u0026rdquo; easy blockchain challenge from HTB University CTF 2024.","inLanguage":"en","url":"https:\/\/simonedimaria.xyz\/posts\/htb-universityctf-2024\/forgottenartifact\/","author":{"@type":"Person","name":"simonedimaria"},"copyrightYear":"2024","dateCreated":"2024-12-05T00:00:02\u002b01:00","datePublished":"2024-12-05T00:00:02\u002b01:00","dateModified":"2024-12-05T00:00:02\u002b01:00","keywords":["authored","EVM","storage"],"mainEntityOfPage":"true","wordCount":"1532"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium">simonedimaria&rsquo;s blog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Blog><p class="text-base font-medium">Blog</p></a><a href=/tags/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Tags title=Tags><p class="text-base font-medium">Tags</p></a><a href=https://x.com/dimariasimone target=_blank class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=x-twitter title><span><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span>
</span></a><a href=https://github.com/simonedimaria target=_blank class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a href class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" title></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Blog title=Blog><p class="text-bg font-bg">Blog</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=Tags title=Tags><p class="text-bg font-bg">Tags</p></a></li><li class=mt-1><a href=https://x.com/dimariasimone target=_blank class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=x-twitter title><div><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></div></a></li><li class=mt-1><a href=https://github.com/simonedimaria target=_blank class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" aria-label=github title><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div></a></li><li class=mt-1><a href class="flex items-center hover:text-primary-600 dark:hover:text-primary-400" title></a></li></ul></div></div></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><figure><img src=/posts/htb-universityctf-2024/forgottenartifact/background_htbunictf_banner_hu_47b3152164975ed.png alt="HTB University CTF 2024 - ForgottenArtifact [Author Writeup]" loading=eager decoding=async fetchpriority=high class="w-full rounded-lg single_hero_round nozoom"></figure><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Blog</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/htb-universityctf-2024/forgottenartifact/>HTB University CTF 2024 - ForgottenArtifact [Author Writeup]</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">HTB University CTF 2024 - ForgottenArtifact [Author Writeup]</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2024-12-05T00:00:02+01:00>5 December 2024</time><span class="px-2 text-primary-500">&#183;</span><span>1532 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">8 mins</span><span class="px-2 text-primary-500">&#183;</span><span class=mb-[2px]>
<span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentColor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/categories/blockchain/","_self"),!1'><span class=flex style=cursor:pointer><span class="bg-amber-700 rounded-full border-2 border-neutral-200 px-3 py-1 text-sm font-normal text-neutral-200 dark:border-neutral-400 dark:text-neutral-200">ðŸ”— Blockchain
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/authored/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Authored
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/evm/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">EVM
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/storage/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Storage</span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full me-4" width=96 height=96 alt=simonedimaria src=/img/gatto-stregone-ciccione_hu_69c1c100a967a305.jpeg data-zoom-src=/img/gatto-stregone-ciccione.jpeg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">simonedimaria</div><div class="text-sm text-neutral-700 dark:text-neutral-400"><em>I make a bunch of electrons dance on some rock to hack stuff</em></div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/dimariasimone target=_blank aria-label=X-Twitter title=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/simonedimaria target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TLDR</a></li><li><a href=#description>Description</a></li><li><a href=#skills-required>Skills Required</a></li><li><a href=#skills-learned>Skills Learned</a></li><li><a href=#challenge-scenario>Challenge Scenario</a></li><li><a href=#analyzing-the-source-code>Analyzing the Source Code</a><ul><li><a href=#setupsol><code>Setup.sol</code></a></li><li><a href=#forgottenartifactsol><code>ForgottenArtifact.sol</code></a></li></ul></li><li><a href=#exploitation>Exploitation</a><ul><li><a href=#step-1-get-current-block-information>Step 1: get current block information</a></li><li><a href=#step-2-retrieve-transaction-details>Step 2: retrieve transaction details</a></li><li><a href=#step-3-reconstruct-seed-hash>Step 3: reconstruct <code>seed</code> hash</a></li><li><a href=#step-4-call-function-discover-with-the-calculated-hash>Step 4: call function <code>discover()</code> with the calculated hash</a></li></ul></li><li><a href=#bonus>Bonus</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TLDR</a></li><li><a href=#description>Description</a></li><li><a href=#skills-required>Skills Required</a></li><li><a href=#skills-learned>Skills Learned</a></li><li><a href=#challenge-scenario>Challenge Scenario</a></li><li><a href=#analyzing-the-source-code>Analyzing the Source Code</a><ul><li><a href=#setupsol><code>Setup.sol</code></a></li><li><a href=#forgottenartifactsol><code>ForgottenArtifact.sol</code></a></li></ul></li><li><a href=#exploitation>Exploitation</a><ul><li><a href=#step-1-get-current-block-information>Step 1: get current block information</a></li><li><a href=#step-2-retrieve-transaction-details>Step 2: retrieve transaction details</a></li><li><a href=#step-3-reconstruct-seed-hash>Step 3: reconstruct <code>seed</code> hash</a></li><li><a href=#step-4-call-function-discover-with-the-calculated-hash>Step 4: call function <code>discover()</code> with the calculated hash</a></li></ul></li><li><a href=#bonus>Bonus</a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!1,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">ForgottenArtifact<div id=forgottenartifact class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#forgottenartifact aria-label=Anchor>#</a></span></h1><p>5<sup>th</sup> Dec 2024<br>Prepared By: perrythepwner<br>Challenge Author(s): <strong>perrythepwner</strong><br>Difficulty: <font color=green>Easy</font></p><a id=github-resource-c8ac373428bffe94799307f1c37e4c17 target=_blank href=https://github.com/simonedimaria/my-ctf-challenges/tree/main/HTB-UniversityCTF-2024/ForgottenArtifact class=cursor-pointer><div class="w-full md:w-auto pt-3 p-5 border border-neutral-200 dark:border-neutral-700 border rounded-md shadow-2xl"><div class="flex items-center"><span class="text-2xl text-neutral-800 dark:text-neutral" style=margin-right:10px><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><div id=github-resource-c8ac373428bffe94799307f1c37e4c17-full_name class="m-0 font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral">simonedimaria/my-ctf-challenges</div></div><p id=github-resource-c8ac373428bffe94799307f1c37e4c17-description class="m-0 mt-2 text-md text-neutral-800 dark:text-neutral">My authored CTF challenges sources and official writeups</p><div class="m-0 mt-2 flex items-center"><span class="mr-1 inline-block h-3 w-3 rounded-full" style=background-color:#0077b6></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">Solidity</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentColor" d="M287.9.0C297.1.0 305.5 5.25 309.5 13.52L378.1 154.8l153.3 22.7C540.4 178.8 547.8 185.1 550.7 193.7 553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4l26.3 155.5C461.4 492.9 457.7 502.1 450.2 507.4 442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9 150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4 118.2 502.1 114.5 492.9 115.1 483.9l27.1-155.5L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7 28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8 266.3 13.52C270.4 5.249 278.7.0 287.9.0zm0 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9 184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7l105.2-56.2C283.7 383.7 292.2 383.7 299.2 387.5l105.2 56.2-20.2-119.6C382.9 316.4 385.5 308.5 391 303l85.9-85.1-118.3-17.4C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg></span></span><div id=github-resource-c8ac373428bffe94799307f1c37e4c17-stargazers class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">0</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M80 104c13.3.0 24-10.7 24-24S93.3 56 80 56 56 66.7 56 80s10.7 24 24 24zm80-24c0 32.8-19.7 61-48 73.3V192c0 17.7 14.3 32 32 32H304c17.7.0 32-14.3 32-32V153.3C307.7 141 288 112.8 288 80c0-44.2 35.8-80 80-80s80 35.8 80 80c0 32.8-19.7 61-48 73.3V192c0 53-43 96-96 96H256v70.7c28.3 12.3 48 40.5 48 73.3.0 44.2-35.8 80-80 80s-80-35.8-80-80c0-32.8 19.7-61 48-73.3V288H144c-53 0-96-43-96-96V153.3C19.7 141 0 112.8.0 80 0 35.8 35.8.0 80 0s80 35.8 80 80zm208 24c13.3.0 24-10.7 24-24s-10.7-24-24-24-24 10.7-24 24 10.7 24 24 24zM248 432c0-13.3-10.7-24-24-24s-24 10.7-24 24 10.7 24 24 24 24-10.7 24-24z"/></svg></span></span><div id=github-resource-c8ac373428bffe94799307f1c37e4c17-forks class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">0</div><code class="px-2 py-1 rounded bg-neutral-200 text-neutral-800 dark:bg-neutral-800 dark:text-neutral-100 text-sm">/tree/main/HTB-UniversityCTF-2024/ForgottenArtifact</code></div></div><script>fetch("https://api.github.com/repos/simonedimaria/my-ctf-challenges",{headers:new Headers({"User-agent":"Mozilla/4.0 Custom User Agent"})}).then(e=>e.json()).then(e=>{e.full_name&&(document.getElementById("github-resource-c8ac373428bffe94799307f1c37e4c17-full_name").innerHTML=e.full_name),e.description&&(document.getElementById("github-resource-c8ac373428bffe94799307f1c37e4c17-description").innerHTML=e.description),e.stargazers_count!==0[0]&&(document.getElementById("github-resource-c8ac373428bffe94799307f1c37e4c17-stargazers").innerHTML=e.stargazers_count),e.forks!==0[0]&&(document.getElementById("github-resource-c8ac373428bffe94799307f1c37e4c17-forks").innerHTML=e.forks)}).catch(e=>console.error(e))</script></a><hr><h2 class="relative group">TLDR<div id=tldr class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#tldr aria-label=Anchor>#</a></span></h2><p>This challenge consists of calculating the storage pointer of a struct stored in a non-standard location in the contract memory to re-discover the &ldquo;forgotten artifact&rdquo; called &ldquo;Starry Spurr&rdquo;.</p><h2 class="relative group">Description<div id=description class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#description aria-label=Anchor>#</a></span></h2><blockquote><p>Deep within the uncharted territories of the Frontier Cluster lies a relic of immense power and mysteryâ€”the forgotten artifact known as &ldquo;The Starry Spurr.&rdquo; Hidden away by the oppressive Frontier Board, its location has been lost to time. However, whispers persist that the artifact can only be recovered by those who understand the intricate mechanisms of the ledger technology. Your goal is to rediscover its location before the Frontier Board finds it and claim possession for the sake of power and wealth.</p></blockquote><h2 class="relative group">Skills Required<div id=skills-required class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#skills-required aria-label=Anchor>#</a></span></h2><ul><li>Basic understanding of Solidity and smart contracts</li><li>Interaction with smart contracts</li><li>Knowledge of Ethereum&rsquo;s storage layout and storage pointers</li></ul><h2 class="relative group">Skills Learned<div id=skills-learned class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#skills-learned aria-label=Anchor>#</a></span></h2><ul><li>Calculating and manipulating non-standard location of storage slots in Solidity</li></ul><h2 class="relative group">Challenge Scenario<div id=challenge-scenario class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#challenge-scenario aria-label=Anchor>#</a></span></h2><p>The Frontier Cluster, once a beacon of hope and prosperity, has been overshadowed by the ruthless Frontier Board. Among the many secrets they guard, &ldquo;The Starry Spurr&rdquo; remains the most coveted artifact, believed to possess unparalleled power. This artifact was hidden using sophisticated blockchain mechanisms to ensure its secrecy and protection.<br>The players goal is to rediscover the forgotten artifact in the smart contract by reverse-engineering the original storing mechanism, before the Frontier Board finds it and claim possession for the sake of power and wealth.</p><h2 class="relative group">Analyzing the Source Code<div id=analyzing-the-source-code class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#analyzing-the-source-code aria-label=Anchor>#</a></span></h2><h3 class="relative group"><code>Setup.sol</code><div id=setupsol class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#setupsol aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: MIT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>pragma solidity</span> <span class=o>^</span><span class=mi>0</span><span class=p>.</span><span class=mi>8</span><span class=p>.</span><span class=mi>18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>{</span> <span class=n>ForgottenArtifact</span> <span class=p>}</span> <span class=k>from</span> <span class=s>&#34;./ForgottenArtifact.sol&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>contract</span> <span class=nc>Setup</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=k>public</span> <span class=k>constant</span> <span class=n>ARTIFACT_ORIGIN</span> <span class=o>=</span> <span class=mh>0xdead</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ForgottenArtifact</span> <span class=k>public</span> <span class=k>immutable</span> <span class=n>TARGET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>event</span> <span class=nc>DeployedTarget</span><span class=p>(</span><span class=kt>address</span> <span class=n>at</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>constructor</span><span class=p>()</span> <span class=k>payable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>TARGET</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ForgottenArtifact</span><span class=p>(</span><span class=kt>uint32</span><span class=p>(</span><span class=n>ARTIFACT_ORIGIN</span><span class=p>),</span> <span class=kt>address</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>emit</span> <span class=n>DeployedTarget</span><span class=p>(</span><span class=kt>address</span><span class=p>(</span><span class=n>TARGET</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>isSolved</span><span class=p>()</span> <span class=k>public</span> <span class=k>view</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>TARGET</span><span class=p>.</span><span class=n>lastSighting</span><span class=p>()</span> <span class=o>&gt;</span> <span class=n>ARTIFACT_ORIGIN</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In order to satify the conditions to solve this challenge, the <code>lastSighting</code> storage variable of the target contract, should be set at a value higher that <code>ARTIFACT_ORIGIN</code>.</p><h3 class="relative group"><code>ForgottenArtifact.sol</code><div id=forgottenartifactsol class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#forgottenartifactsol aria-label=Anchor>#</a></span></h3><p>The <code>ForgottenArtifact</code> smart contract was used to hide the artifact in its storage memory, by crafting a pseudo-generated storage pointer and using low level assembly to move the struct pointer of the artifact to that newly generated location.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: MIT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>pragma solidity</span> <span class=o>^</span><span class=mi>0</span><span class=p>.</span><span class=mi>8</span><span class=p>.</span><span class=mi>18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>contract</span> <span class=nc>ForgottenArtifact</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint256</span> <span class=k>public</span> <span class=n>lastSighting</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>struct</span> <span class=nc>Artifact</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint32</span> <span class=nb>origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>address</span> <span class=n>discoverer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>constructor</span><span class=p>(</span><span class=kt>uint32</span> <span class=n>_origin</span><span class=p>,</span> <span class=kt>address</span> <span class=n>_discoverer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Artifact</span> <span class=k>storage</span> <span class=n>starrySpurr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>seed</span> <span class=o>=</span> <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encodePacked</span><span class=p>(</span><span class=nb>block</span><span class=p>.</span><span class=nb>number</span><span class=p>,</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>,</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>assembly</span> { <span class=n>starrySpurr</span><span class=p>.</span><span class=n>slot</span> <span class=o>:=</span> <span class=n>seed</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>starrySpurr</span><span class=p>.</span><span class=nb>origin</span> <span class=o>=</span> <span class=n>_origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>starrySpurr</span><span class=p>.</span><span class=n>discoverer</span> <span class=o>=</span> <span class=n>_discoverer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>lastSighting</span> <span class=o>=</span> <span class=n>_origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>discover</span><span class=p>(</span><span class=kt>bytes32</span> <span class=n>_artifactLocation</span><span class=p>)</span> <span class=k>public</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Artifact</span> <span class=k>storage</span> <span class=n>starrySpurr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>assembly</span> { <span class=n>starrySpurr</span><span class=p>.</span><span class=n>slot</span> <span class=o>:=</span> <span class=n>_artifactLocation</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>starrySpurr</span><span class=p>.</span><span class=nb>origin</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;ForgottenArtifact: unknown artifact location.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>starrySpurr</span><span class=p>.</span><span class=n>discoverer</span> <span class=o>=</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>lastSighting</span> <span class=o>=</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In detail:</p><ul><li><strong><code>lastSighting</code></strong>: Tracks the last time the artifact was sighted. This variable is written at the contract creation by the constructor. The only way to modify it is within the <code>discover</code> function.</li><li><strong><code>Artifact</code> struct</strong>: Define the structer of the Artifact. It contains the <code>origin</code> of the artifact (timestamp) and the <code>discoverer</code>&rsquo;s address.</li><li><strong>Constructor</strong>:<ul><li>Calculates a psuedo-random <code>seed</code>, which will be then used as storage pointer, using the current <code>block.number</code>, <code>block.timestamp</code>, and <code>msg.sender</code>, which can be easily re-calculated.</li><li>Uses assembly to assign the <code>seed</code> as the storage slot for <code>starrySpurr</code>.</li><li>Initializes the <code>Artifact</code> struct with the provided <code>_origin</code> and <code>_discoverer</code>.</li><li>Sets <code>lastSighting</code> to <code>_origin</code>.</li></ul></li><li><strong><code>discover()</code> function</strong>:<ul><li>Accepts a <code>_artifactLocation</code> parameter, presumed to be the storage slot of the artifact.</li><li>Uses assembly to load the <code>Artifact</code> stored at <code>_artifactLocation</code> (if any).</li><li>Requires that the <code>origin</code> is not zero, ensuring the artifact location is valid.</li><li>Updates the <code>discoverer</code> to <code>msg.sender</code> and <code>lastSighting</code> to the current block timestamp.</li></ul></li></ul><p>As we understood, the artifact, which is in the form of a struct, is not stored to a conventional location in the contract&rsquo;s storage layout, and this time it cannot be simply retrieved by using <code>eth_getStorageAt</code> and passing slot <code>0</code> as an argument.<br>Instead, using low level assembly, the contract sets its storage location using the <code>seed</code> variable:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=n>Artifact</span> <span class=k>storage</span> <span class=n>starrySpurr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>bytes32</span> <span class=n>seed</span> <span class=o>=</span> <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encodePacked</span><span class=p>(</span><span class=nb>block</span><span class=p>.</span><span class=nb>number</span><span class=p>,</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>,</span> <span class=nb>msg</span><span class=p>.</span><span class=nb>sender</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>assembly</span> { <span class=n>starrySpurr</span><span class=p>.</span><span class=n>slot</span> <span class=o>:=</span> <span class=n>seed</span> <span class=p>}</span>
</span></span></code></pre></div><p>The first line creates a new variable <code>starrySpurr</code> by specifying the location as storage, which means it references a specific location in the contract&rsquo;s persistent storage rather than being a memory or calldata variable. This allows direct interaction with the contract&rsquo;s storage, see more information in the documentation <a href=https://docs.soliditylang.org/en/latest/internals/layout_in_storage.html target=_blank>here</a>.<br>Then, <code>seed</code> is generated by hashing the combination of <code>block.number</code>, <code>block.timestamp</code>, and <code>msg.sender</code>. If these values can be predicted or known, the storage slot can be recalculated.<br>Finally, low level assembly is used to assign the <code>seed</code> as the storage slot for <code>starrySpurr</code>, effectively pointing the Artifact struct to a specific storage location that can be targeted for exploitation.<br>In other words, these lines serves as a way to store a storage variable in a non-conventional storage slot by generating runtime a storage pointer.<br>The goal of the player at this point is just to reverse engineer the pointer generation logic.</p><p>Although the logic for this one is pretty simple, we can avoid falling for silly mistakes and use Solidity code to directly generate that. For example, We can use <a href=https://book.getfoundry.sh/chisel/ target=_blank>chisel</a> tool from the Foundry collection to have a nice Solidity REPL in our terminal to do so.</p><p>However, the generation of this hash depends on block-specific variables (<code>block.number</code>, <code>block.timestamp</code>), meaning that, in order to reconstruct the correct hash, we need to recover the values for this variables used at the time of the contract creation.<br>In order to do so, we can use tools like <a href=https://book.getfoundry.sh/cast/ target=_blank>cast</a>, <a href=https://web3py.readthedocs.io/en/stable/ target=_blank>web3py</a> to fetch past transactions details.</p><h2 class="relative group">Exploitation<div id=exploitation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#exploitation aria-label=Anchor>#</a></span></h2><p>To solve this challenge, we have to re-calculate the seed hash used as pointer to store the artifact, and pass is to the <code>discover()</code> function as argument in order to set <code>lastSighting</code> variable to a new block timestamp.</p><h3 class="relative group">Step 1: get current block information<div id=step-1-get-current-block-information class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#step-1-get-current-block-information aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>âžœ cast block --rpc-url <span class=nv>$RPC</span>
</span></span><span class=line><span class=cl>baseFeePerGas        <span class=m>0</span>
</span></span><span class=line><span class=cl>difficulty           <span class=m>0</span>
</span></span><span class=line><span class=cl>extraData            0x
</span></span><span class=line><span class=cl>gasLimit             <span class=m>30000000</span>
</span></span><span class=line><span class=cl>gasUsed              <span class=m>293780</span>
</span></span><span class=line><span class=cl><span class=nb>hash</span>                 0xd3e04275d3d832f6cab1f986fcb3b2d6e5dce9cd3914f0d76098f57923785066
</span></span><span class=line><span class=cl>logsBloom            0x00000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000
</span></span><span class=line><span class=cl>miner                0x0000000000000000000000000000000000000000
</span></span><span class=line><span class=cl>mixHash              0x0000000000000000000000000000000000000000000000000000000000000000
</span></span><span class=line><span class=cl>nonce                0x0000000000000000
</span></span><span class=line><span class=cl>number               <span class=m>1</span>
</span></span><span class=line><span class=cl>parentHash           0xc344a56f72f4ae832f7ef060fe7acd0e367644d7aa3c364877e367086d09469d
</span></span><span class=line><span class=cl>transactionsRoot     0x127229900c01b9e389b79b9f51caeb7175b90f64591896aa6765381d2ff69c7a
</span></span><span class=line><span class=cl>receiptsRoot         0x8294aad7e40b8fa738672bd806843726d2e94498d87ebdf0b38c5e83464c02f8
</span></span><span class=line><span class=cl>sha3Uncles           0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347
</span></span><span class=line><span class=cl>size                 <span class=m>1856</span>
</span></span><span class=line><span class=cl>stateRoot            0xd2ad8861be652b2cff0e61187388187f690844e24fcbf4cf48d227ed56fab617
</span></span><span class=line><span class=cl>timestamp            <span class=m>1734026033</span> <span class=o>(</span>Thu, <span class=m>12</span> Dec <span class=m>2024</span> 17:53:53 +0000<span class=o>)</span>
</span></span><span class=line><span class=cl>withdrawalsRoot      0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421
</span></span><span class=line><span class=cl>totalDifficulty      <span class=m>0</span>
</span></span><span class=line><span class=cl>transactions:        <span class=o>[</span>
</span></span><span class=line><span class=cl>        0xf35c20de71490188ba89db398afdf07a7b3853e150fe0807cc4f266f7b2c613f
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></div><p>We see that only 1 block is mined, and it&rsquo;s block number <code>1</code>, we needed that. The block contains only 1 transaction, possibly the contract creation. We can use <code>cast</code> again to fetch for detailed information using the provided transaction hash.<br>Another important value we can notice, is the <code>timestamp</code> param, giving us the <code>block.timestamp</code> value we needed (<code>1734026033</code>).</p><h3 class="relative group">Step 2: retrieve transaction details<div id=step-2-retrieve-transaction-details class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#step-2-retrieve-transaction-details aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>âžœ cast tx 0xf35c20de71490188ba89db398afdf07a7b3853e150fe0807cc4f266f7b2c613f --rpc-url <span class=nv>$RPC</span>
</span></span><span class=line><span class=cl>accessList           <span class=o>[]</span>
</span></span><span class=line><span class=cl>blockHash            0xd3e04275d3d832f6cab1f986fcb3b2d6e5dce9cd3914f0d76098f57923785066
</span></span><span class=line><span class=cl>blockNumber          <span class=m>1</span>
</span></span><span class=line><span class=cl>chainId              <span class=m>31337</span>
</span></span><span class=line><span class=cl>from                 0x5B288F7f432156D2653CC518859b6FD5F77a3123
</span></span><span class=line><span class=cl>gasLimit             <span class=m>293780</span>
</span></span><span class=line><span class=cl><span class=nb>hash</span>                 0xf35c20de71490188ba89db398afdf07a7b3853e150fe0807cc4f266f7b2c613f
</span></span><span class=line><span class=cl>input                0x60a060405261dead5f604051601290608b565b63ffffffff90921682526001600160a01b03166020820152604001604051809103905ff0801580156045573d5f5f3e3d5ffd5b506001600160a01b031660808190526040519081527fc26ec5464cc58ea5f3597f1daab5d82585655e1bfd634b0a94fdd5ab63740dbf9060200160405180910390a16098565b6102558061024283390190565b60805161018d6100b55f395f8181607c015260bc015261018d5ff3fe608060405234801561000f575f5ffd5b506004361061003f575f3560e01c8063468e2c681461004357806364d98f6e1461005f578063cc1f2afa14610077575b5f5ffd5b61004c61dead81565b6040519081526020015b60405180910390f35b6100676100b6565b6040519015158152602001610056565b61009e7f000000000000000000000000000000000000000000000000000000000000000081565b6040516001600160a01b039091168152602001610056565b5f61dead7f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316634e3d72b26040518163ffffffff1660e01b8152600401602060405180830381865afa158015610116573d5f5f3e3d5ffd5b505050506040513d601f19601f8201168201806040525081019061013a9190610140565b11905090565b5f60208284031215610150575f5ffd5b505191905056fea2646970667358221220a80d2b468a927403c0935c79d3bfca66e9ffe0eddd8714585fde84d6b8359b9264736f6c634300081c0033608060405234801561000f575f5ffd5b5060405161025538038061025583398101604081905261002e916100b6565b5f5f43423360405160200161006393929190928352602083019190915260601b6001600160601b031916604082015260540190565b60408051601f19818403018152919052805160209091012080546001600160a01b03909416640100000000026001600160c01b031990941663ffffffff9095169485179390931790925550505f55610101565b5f5f604083850312156100c7575f5ffd5b825163ffffffff811681146100da575f5ffd5b60208401519092506001600160a01b03811681146100f6575f5ffd5b809150509250929050565b6101478061010e5f395ff3fe608060405234801561000f575f5ffd5b5060043610610034575f3560e01c80630f9b5d1f146100385780634e3d72b21461004d575b5f5ffd5b61004b6100463660046100fa565b610067565b005b6100555f5481565b60405190815260200160405180910390f35b8054819063ffffffff165f036100d95760405162461bcd60e51b815260206004820152602d60248201527f466f72676f7474656e41727469666163743a20756e6b6e6f776e20617274696660448201526c30b1ba103637b1b0ba34b7b71760991b606482015260840160405180910390fd5b8054640100000000600160c01b031916336401000000000217905550425f55565b5f6020828403121561010a575f5ffd5b503591905056fea2646970667358221220c457a2f3cb835798de697f5a7f785f8f5835342365fe4032d2f55d95d8169efb64736f6c634300081c0033
</span></span><span class=line><span class=cl>maxFeePerGas         <span class=m>1000000000</span>
</span></span><span class=line><span class=cl>maxPriorityFeePerGas <span class=m>1000000000</span>
</span></span><span class=line><span class=cl>nonce                <span class=m>0</span>
</span></span><span class=line><span class=cl>r                    0x34b919a9b01d04a2b0b11191e3308adbaf13abc314bef31f1b0d952e75580969
</span></span><span class=line><span class=cl>s                    0x39bfd5b956a7c1c0301b02733fc773e6c6f7519088679cb0020f77eb375e297d
</span></span><span class=line><span class=cl>to
</span></span><span class=line><span class=cl>transactionIndex     <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nb>type</span>                 <span class=m>2</span>
</span></span><span class=line><span class=cl>value                <span class=m>0</span>
</span></span><span class=line><span class=cl>yParity              <span class=m>1</span>
</span></span></code></pre></div><p>The transaction with long data, the <code>to</code> param pointing to address zero, and the first bytes of the data being <code>0x60a06040</code> (see why <a href=https://ethereum.stackexchange.com/questions/129737/new-contract-deployment-pattern-0x60c06040 target=_blank>here</a>), confirms the transaction as the one that created the contract.<br>Note that, the <code>from</code> parameter in this transaction, won&rsquo;t be the actual <code>msg.sender</code> used to calculate the hash in the <code>ForgottenArtifact</code> contract, because the <code>Setup</code> contracts is responsible to deploy the challenge contract and therefore the constructor will see the address of <code>Setup</code> as the actual <code>msg.sender</code>. The setup contract address can be easily retrieved using the TCP challenge handler:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>âžœ nc <span class=nv>$IP</span> <span class=nv>$PORT</span>
</span></span><span class=line><span class=cl><span class=m>1</span> - Get connection informations
</span></span><span class=line><span class=cl><span class=m>2</span> - Restart Instance
</span></span><span class=line><span class=cl><span class=m>3</span> - Get flag
</span></span><span class=line><span class=cl>Select action <span class=o>(</span>enter number<span class=o>)</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Found node running. Retrieving connection informations...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl>Setup contract     : 0xd5CBC771f1148636AbE03472cFA7c4c7CBAc3B03
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span></code></pre></div><h3 class="relative group">Step 3: reconstruct <code>seed</code> hash<div id=step-3-reconstruct-seed-hash class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#step-3-reconstruct-seed-hash aria-label=Anchor>#</a></span></h3><p>As we have everything we need to reconstruct the storage pointer used, i.e. the artifact location, we can finally use <code>chisel</code> to easily calculate the hash.</p><p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt src=./assets/chisel_hash_calculation.png></figure></p><h3 class="relative group">Step 4: call function <code>discover()</code> with the calculated hash<div id=step-4-call-function-discover-with-the-calculated-hash class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#step-4-call-function-discover-with-the-calculated-hash aria-label=Anchor>#</a></span></h3><p>At this point, we just need to call the <code>discover</code> function with the correct hash, i.e. the artifact storage location pointer.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>âžœ cast send <span class=nv>$TARGET</span> <span class=s2>&#34;discover(bytes32)&#34;</span> 0xb34a2018396418630fe56fe68d75a2830563cfc352cc333f60dc95b7f571819d --rpc-url <span class=nv>$RPC</span> --private-key <span class=nv>$PVK</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>blockHash               0x99f4e19feb3a73b69c00d3332d233a24042e49f821d99e0c7502ecda3b8051a6
</span></span><span class=line><span class=cl>blockNumber             <span class=m>5</span>
</span></span><span class=line><span class=cl>contractAddress
</span></span><span class=line><span class=cl>cumulativeGasUsed       <span class=m>31953</span>
</span></span><span class=line><span class=cl>effectiveGasPrice       <span class=m>1000000000</span>
</span></span><span class=line><span class=cl>from                    0x3475E621b91f45b02Af368EcC147B0a90Acad4D5
</span></span><span class=line><span class=cl>gasUsed                 <span class=m>31953</span>
</span></span><span class=line><span class=cl>logs                    <span class=o>[]</span>
</span></span><span class=line><span class=cl>logsBloom               0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
</span></span><span class=line><span class=cl>root
</span></span><span class=line><span class=cl>status                  <span class=m>1</span> <span class=o>(</span>success<span class=o>)</span>
</span></span><span class=line><span class=cl>transactionHash         0x8ba39c9d1958c49f4160ae9e8a85826eed7a1b9577e0b55d7790f297179ded13
</span></span><span class=line><span class=cl>transactionIndex        <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nb>type</span>                    <span class=m>2</span>
</span></span><span class=line><span class=cl>blobGasPrice            <span class=m>1</span>
</span></span><span class=line><span class=cl>blobGasUsed
</span></span><span class=line><span class=cl>authorizationList
</span></span><span class=line><span class=cl>to                      0x8fBF2638fD86021c3Db33c70bE3d06B64C549dA7
</span></span></code></pre></div><p>Win!<br>We can now connect back to the challenge handler, that will check conditions by calling the <code>isSolved()</code> function in the <code>Setup</code> contract, and print the flag.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>âžœ nc <span class=nv>$IP</span> <span class=nv>$PORT</span>
</span></span><span class=line><span class=cl><span class=m>1</span> - Get connection informations
</span></span><span class=line><span class=cl><span class=m>2</span> - Restart Instance
</span></span><span class=line><span class=cl><span class=m>3</span> - Get flag
</span></span><span class=line><span class=cl>Select action <span class=o>(</span>enter number<span class=o>)</span>: <span class=m>3</span>
</span></span><span class=line><span class=cl>HTB<span class=o>{</span>y0u_c4n7_533_m3<span class=o>}</span>
</span></span></code></pre></div><h2 class="relative group">Bonus<div id=bonus class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#bonus aria-label=Anchor>#</a></span></h2><p>We could also have done that using <code>web3py</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=p>[</span><span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ForgottenArtifact</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>contract</span><span class=p>(</span><span class=n>address</span><span class=o>=</span><span class=n>target_addr</span><span class=p>,</span> <span class=n>abi</span><span class=o>=</span><span class=n>target_abi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Setup</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>contract</span><span class=p>(</span><span class=n>address</span><span class=o>=</span><span class=n>setup_addr</span><span class=p>,</span> <span class=n>abi</span><span class=o>=</span><span class=n>setup_abi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Retrieving artifact origin transaction&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>logs</span> <span class=o>=</span> <span class=n>Setup</span><span class=o>.</span><span class=n>events</span><span class=o>.</span><span class=n>DeployedTarget</span><span class=o>.</span><span class=n>get_logs</span><span class=p>(</span><span class=n>from_block</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>deployed_log</span> <span class=o>=</span> <span class=n>logs</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>origin_tx</span> <span class=o>=</span> <span class=n>deployed_log</span><span class=p>[</span><span class=s2>&#34;transactionHash&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Origin transaction: </span><span class=si>{</span><span class=n>origin_tx</span><span class=si>}</span><span class=s2> @ block </span><span class=si>{</span><span class=n>deployed_log</span><span class=p>[</span><span class=s1>&#39;blockNumber&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Retrieving block informations&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>origin_block</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>eth</span><span class=o>.</span><span class=n>get_block</span><span class=p>(</span><span class=n>deployed_log</span><span class=p>[</span><span class=s2>&#34;blockNumber&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Block informations: </span><span class=si>{</span><span class=n>origin_block</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>block_number</span> <span class=o>=</span> <span class=n>origin_block</span><span class=p>[</span><span class=s2>&#34;number&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>block_timestamp</span> <span class=o>=</span> <span class=n>origin_block</span><span class=p>[</span><span class=s2>&#34;timestamp&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Block number: </span><span class=si>{</span><span class=n>deployed_log</span><span class=p>[</span><span class=s1>&#39;blockNumber&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>, timestamp: </span><span class=si>{</span><span class=n>block_timestamp</span><span class=si>}</span><span class=s2>, msg.sender: </span><span class=si>{</span><span class=n>setup_addr</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>seed</span> <span class=o>=</span> <span class=n>w3</span><span class=o>.</span><span class=n>keccak</span><span class=p>(</span><span class=n>encode_packed</span><span class=p>([</span><span class=s2>&#34;uint&#34;</span><span class=p>,</span> <span class=s2>&#34;uint&#34;</span><span class=p>,</span> <span class=s2>&#34;address&#34;</span><span class=p>],</span> <span class=p>[</span><span class=n>deployed_log</span><span class=p>[</span><span class=s2>&#34;blockNumber&#34;</span><span class=p>],</span> <span class=n>block_timestamp</span><span class=p>,</span> <span class=n>setup_addr</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Artifact storage pointer location: 0x</span><span class=si>{</span><span class=n>seed</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Discovering artifact&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ForgottenArtifact</span><span class=o>.</span><span class=n>functions</span><span class=o>.</span><span class=n>discover</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span><span class=o>.</span><span class=n>transact</span><span class=p>()</span>
</span></span></code></pre></div><p>see the full exploitation script <a href=./htb/solver.py>here</a>.</p><hr><blockquote><p>HTB{y0u_c4n7_533_m3}</p></blockquote></div></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/HTB-UniversityCTF-2024/ForgottenArtifact/index.md data-oid-likes=likes_posts/HTB-UniversityCTF-2024/ForgottenArtifact/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/htb-universityctf-2024/cryopod/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;HTB University CTF 2024 - CryoPod [Author Writeup]
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2024-12-05T00:00:01+01:00>5 December 2024</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/htb-universityctf-2024/frontiermarketplace/><span class=leading-6>HTB University CTF 2024 - FrontierMarketplace [Author Writeup]&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2024-12-05T00:00:03+01:00>5 December 2024</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
simonedimaria</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://simonedimaria.xyz/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>