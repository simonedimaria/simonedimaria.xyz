<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>HTB University CTF 2024 - Stargazer [Author Writeup] &#183; simonedimaria's blog</title><meta name=title content="HTB University CTF 2024 - Stargazer [Author Writeup] &#183; simonedimaria's blog"><meta name=description content='Author writeup for the "Stargazer" hard blockchain challenge from HTB University CTF 2024.'><meta name=keywords content="authored,proxy-pattern,UUPS,ERC-7201,storage-collision,ecrecover,"><link rel=canonical href=https://simonedimaria.xyz/posts/htb-universityctf-2024/stargazer/><link type=text/css rel=stylesheet href=/css/main.bundle.min.e8ecfa8c231dc2be7f76b48553863a329b015571e7a6c5d435d79f72dad5382363795195ae0b75dbf10dc1f0e597e591c01584a1f0b03bf742d5241f6f1acede.css integrity="sha512-6Oz6jCMdwr5/drSFU4Y6MpsBVXHnpsXUNdefctrVOCNjeVGVrgt12/ENwfDll+WRwBWEofCwO/dC1SQfbxrO3g=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.ca27df28587cb7e03bdd8ef90eb9a32221cf4f2573466906cca183a2284608b6ab025a77a00f66834419e9e5eb74076afd3e8116fbbe417b6f161e2c5e5aa049.js integrity="sha512-yiffKFh8t+A73Y75DrmjIiHPTyVzRmkGzKGDoihGCLarAlp3oA9mg0QZ6eXrdAdq/T6BFvu+QXtvFh4sXlqgSQ==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.f592a181a15d2a5b042daa7f746c3721acf9063f8b6acd175d989129865a37d400ae0e85b640f9ad42cd98d1f8ad30931718cf8811abdcc5fcb264400d1a2b0c.js integrity="sha512-9ZKhgaFdKlsELap/dGw3Iaz5Bj+Las0XXZiRKYZaN9QArg6FtkD5rULNmNH4rTCTFxjPiBGr3MX8smRADRorDA=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://simonedimaria.xyz/posts/htb-universityctf-2024/stargazer/"><meta property="og:site_name" content="simonedimaria's blog"><meta property="og:title" content="HTB University CTF 2024 - Stargazer [Author Writeup]"><meta property="og:description" content="Author writeup for the â€œStargazerâ€ hard blockchain challenge from HTB University CTF 2024."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-05T00:00:04+01:00"><meta property="article:modified_time" content="2024-12-05T00:00:04+01:00"><meta property="article:tag" content="Authored"><meta property="article:tag" content="Proxy-Pattern"><meta property="article:tag" content="UUPS"><meta property="article:tag" content="ERC-7201"><meta property="article:tag" content="Storage-Collision"><meta property="article:tag" content="Ecrecover"><meta property="og:image" content="https://simonedimaria.xyz/posts/htb-universityctf-2024/stargazer/featured_htbunictf_banner.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simonedimaria.xyz/posts/htb-universityctf-2024/stargazer/featured_htbunictf_banner.png"><meta name=twitter:title content="HTB University CTF 2024 - Stargazer [Author Writeup]"><meta name=twitter:description content="Author writeup for the â€œStargazerâ€ hard blockchain challenge from HTB University CTF 2024."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"HTB University CTF 2024 - Stargazer [Author Writeup]","headline":"HTB University CTF 2024 - Stargazer [Author Writeup]","abstract":"Author writeup for the \u0026ldquo;Stargazer\u0026rdquo; hard blockchain challenge from HTB University CTF 2024.","inLanguage":"en","url":"https:\/\/simonedimaria.xyz\/posts\/htb-universityctf-2024\/stargazer\/","author":{"@type":"Person","name":"simonedimaria"},"copyrightYear":"2024","dateCreated":"2024-12-05T00:00:04\u002b01:00","datePublished":"2024-12-05T00:00:04\u002b01:00","dateModified":"2024-12-05T00:00:04\u002b01:00","keywords":["authored","proxy-pattern","UUPS","ERC-7201","storage-collision","ecrecover"],"mainEntityOfPage":"true","wordCount":"3085"}]</script><meta name=author content="simonedimaria"><link href=https://x.com/dimariasimone rel=me><link href=https://github.com/simonedimaria rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom bg-neutral dark:bg-neutral-800"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">simonedimaria&rsquo;s blog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Blog>Blog</p></a><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Tags>Tags</p></a><a href=https://x.com/dimariasimone target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://github.com/simonedimaria target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Blog>Blog</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Tags>Tags</p></a></li><li class=mt-1><a href=https://x.com/dimariasimone target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href=https://github.com/simonedimaria target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title></p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><figure><img class="w-full rounded-lg single_hero_round nozoom" alt="HTB University CTF 2024 - Stargazer [Author Writeup]" width=1200 height=630 src=/posts/htb-universityctf-2024/stargazer/background_htbunictf_banner_hu_47b3152164975ed.png></figure><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Blog</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/htb-universityctf-2024/stargazer/>HTB University CTF 2024 - Stargazer [Author Writeup]</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">HTB University CTF 2024 - Stargazer [Author Writeup]</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2024-12-05T00:00:04+01:00>5 December 2024</time><span class="px-2 text-primary-500">&#183;</span><span>3085 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">15 mins</span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.eea5245cf9244ecbdf2c150d1c8833226c1541cadf6e98f63a7c9192b1a3676df2c3ec603b14f4cfaaa53971fd9d8955640c0f405bf3de2b43ee7a5fb29ae721.js integrity="sha512-7qUkXPkkTsvfLBUNHIgzImwVQcrfbpj2OnyRkrGjZ23yw+xgOxT0z6qlOXH9nYlVZAwPQFvz3itD7npfsprnIQ=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentColor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/categories/blockchain/","_self"),!1'><span class=flex style=cursor:pointer><span class="bg-amber-700 rounded-full border-2 border-neutral-200 px-3 py-1 text-sm font-normal text-neutral-200 dark:border-neutral-400 dark:text-neutral-200">ðŸ”— Blockchain
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/authored/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Authored
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/proxy-pattern/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Proxy-Pattern
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/uups/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">UUPS
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/erc-7201/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">ERC-7201
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/storage-collision/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Storage-Collision
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='return window.open("/tags/ecrecover/","_self"),!1'><span class=flex style=cursor:pointer><span class="rounded-full border-2 border-primary-400 px-3 py-1 text-sm font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Ecrecover</span></span></span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt=simonedimaria src=/img/gatto-stregone-ciccione_hu_69c1c100a967a305.jpeg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">simonedimaria</div><div class="text-sm text-neutral-700 dark:text-neutral-400"><em>I make a bunch of electrons dance on some rock to hack stuff</em></div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://x.com/dimariasimone target=_blank aria-label=X-Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/simonedimaria target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TLDR</a></li><li><a href=#description>Description</a></li><li><a href=#skills-required>Skills Required</a></li><li><a href=#skills-learned>Skills Learned</a></li><li><a href=#analyzing-the-source-code>Analyzing the source code</a><ul><li><a href=#setupsol><strong><code>Setup.sol</code></strong></a></li><li><a href=#stargazersol><strong><code>Stargazer.sol</code></strong></a></li><li><a href=#stargazerkernelsol><strong><code>StargazerKernel.sol</code></strong></a></li></ul></li><li><a href=#exploitation>Exploitation</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tldr>TLDR</a></li><li><a href=#description>Description</a></li><li><a href=#skills-required>Skills Required</a></li><li><a href=#skills-learned>Skills Learned</a></li><li><a href=#analyzing-the-source-code>Analyzing the source code</a><ul><li><a href=#setupsol><strong><code>Setup.sol</code></strong></a></li><li><a href=#stargazersol><strong><code>Stargazer.sol</code></strong></a></li><li><a href=#stargazerkernelsol><strong><code>StargazerKernel.sol</code></strong></a></li></ul></li><li><a href=#exploitation>Exploitation</a></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})(),function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=decodeURIComponent(t.attr("id")))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active")}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){n()})}}()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">Stargazer<div id=stargazer class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#stargazer aria-label=Anchor>#</a></span></h1><blockquote><p>10<sup>th</sup> Aug 2024<br>Prepared By: perrythepwner<br>Challenge Author(s): perrythepwner<br>Difficulty: <font color=red>Hard</font></p></blockquote><a id=github-resource-b6bd87758d4ad7c8c6a3d3023e492727 target=_blank href=https://github.com/simonedimaria/my-ctf-challenges/tree/main/HTB-UniversityCTF-2024/Stargazer class=cursor-pointer><div class="w-full md:w-auto pt-3 p-5 border border-neutral-200 dark:border-neutral-700 border rounded-md shadow-2xl"><div class="flex items-center"><span class="text-2xl text-neutral-800 dark:text-neutral" style=margin-right:10px><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><div id=github-resource-b6bd87758d4ad7c8c6a3d3023e492727-full_name class="m-0 font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral">simonedimaria/my-ctf-challenges</div></div><p id=github-resource-b6bd87758d4ad7c8c6a3d3023e492727-description class="m-0 mt-2 text-md text-neutral-800 dark:text-neutral">My authored CTF challenges sources and official writeups</p><div class="m-0 mt-2 flex items-center"><span class="mr-1 inline-block h-3 w-3 rounded-full" style=background-color:#aa6746></span><div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">Solidity</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentColor" d="M287.9.0C297.1.0 305.5 5.25 309.5 13.52L378.1 154.8l153.3 22.7C540.4 178.8 547.8 185.1 550.7 193.7 553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4l26.3 155.5C461.4 492.9 457.7 502.1 450.2 507.4 442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9 150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4 118.2 502.1 114.5 492.9 115.1 483.9l27.1-155.5L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7 28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8 266.3 13.52C270.4 5.249 278.7.0 287.9.0zm0 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9 184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7l105.2-56.2C283.7 383.7 292.2 383.7 299.2 387.5l105.2 56.2-20.2-119.6C382.9 316.4 385.5 308.5 391 303l85.9-85.1-118.3-17.4C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg></span></span><div id=github-resource-b6bd87758d4ad7c8c6a3d3023e492727-stargazers class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">0</div><span class="text-md mr-1 text-neutral-800 dark:text-neutral"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M80 104c13.3.0 24-10.7 24-24S93.3 56 80 56 56 66.7 56 80s10.7 24 24 24zm80-24c0 32.8-19.7 61-48 73.3V192c0 17.7 14.3 32 32 32H304c17.7.0 32-14.3 32-32V153.3C307.7 141 288 112.8 288 80c0-44.2 35.8-80 80-80s80 35.8 80 80c0 32.8-19.7 61-48 73.3V192c0 53-43 96-96 96H256v70.7c28.3 12.3 48 40.5 48 73.3.0 44.2-35.8 80-80 80s-80-35.8-80-80c0-32.8 19.7-61 48-73.3V288H144c-53 0-96-43-96-96V153.3C19.7 141 0 112.8.0 80 0 35.8 35.8.0 80 0s80 35.8 80 80zm208 24c13.3.0 24-10.7 24-24s-10.7-24-24-24-24 10.7-24 24 10.7 24 24 24zM248 432c0-13.3-10.7-24-24-24s-24 10.7-24 24 10.7 24 24 24 24-10.7 24-24z"/></svg></span></span><div id=github-resource-b6bd87758d4ad7c8c6a3d3023e492727-forks class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">0</div><code class="px-2 py-1 rounded bg-neutral-200 text-neutral-800 dark:bg-neutral-800 dark:text-neutral-100 text-sm">/tree/main/HTB-UniversityCTF-2024/Stargazer</code></div></div><script>fetch("https://api.github.com/repos/simonedimaria/my-ctf-challenges",{headers:new Headers({"User-agent":"Mozilla/4.0 Custom User Agent"})}).then(e=>e.json()).then(e=>{e.full_name&&(document.getElementById("github-resource-b6bd87758d4ad7c8c6a3d3023e492727-full_name").innerHTML=e.full_name),e.description&&(document.getElementById("github-resource-b6bd87758d4ad7c8c6a3d3023e492727-description").innerHTML=e.description),e.stargazers_count!==0[0]&&(document.getElementById("github-resource-b6bd87758d4ad7c8c6a3d3023e492727-stargazers").innerHTML=e.stargazers_count),e.forks!==0[0]&&(document.getElementById("github-resource-b6bd87758d4ad7c8c6a3d3023e492727-forks").innerHTML=e.forks)}).catch(e=>console.error(e))</script></a><hr><h2 class="relative group">TLDR<div id=tldr class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tldr aria-label=Anchor>#</a></span></h2><p>The challenge consists in exploiting <code>ecrecover</code> signature malleability in a UUPSUpgradeable contract to authorize implementation upgrade and override ERC7201 storage.</p><h2 class="relative group">Description<div id=description class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#description aria-label=Anchor>#</a></span></h2><blockquote><p>The Frontier Cluster teeters on the brink of collapse. The planet is ravaged by exploitation and environmental decay, driven by ruthless corporations that have merged into a singular, omnipotent entity known as &ldquo;The Frontier Board.&rdquo; In a desperate bid to secure humanity&rsquo;s future, a visionary engineer constructs the &ldquo;<em><strong>Stargazer</strong></em>&rdquo;: a conscious and empathetic machine designed to endure the harshest conditions of unknown planets.<br>Stargazer&rsquo;s mission is monumental: to explore uncharted worlds, gather crucial data, and identify new planets suitable for colonization. Equipped with advanced sensors and a soulful artificial intelligence, it traverses the cosmos, witnessing celestial wonders beyond human imagination.<br>Amidst its journey through the stars, Stargazer develops a profound sense of melancholy. Despite observing breathtaking cosmic events (supernovae, nebulae, and elusive shooting stars) it is burdened by the realization that many of these phenomena are transient, never to be witnessed again. One such event is the &ldquo;Starry Spurr,&rdquo; a rare shooting star emitting a unique cosmic frequency, occurring once every millennium.<br>Your goal is to deceive the machine kernel into believing that it is experiencing the advent of &ldquo;Starry Spurr&rdquo; for the second time, in order to bring back joy and solace to the machine.</p></blockquote><h2 class="relative group">Skills Required<div id=skills-required class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#skills-required aria-label=Anchor>#</a></span></h2><ul><li>Knowledge of Ethereum&rsquo;s storage layout and storage pointers</li><li>Familiarity with proxy contracts and upgradeability patterns (UUPS)</li><li>Knowledge of Ethereum signatures and ECDSA</li></ul><h2 class="relative group">Skills Learned<div id=skills-learned class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#skills-learned aria-label=Anchor>#</a></span></h2><ul><li>Identifying and exploiting vulnerabilities in upgradeable smart contracts</li><li>Exploiting signature malleability</li></ul><h2 class="relative group">Analyzing the source code<div id=analyzing-the-source-code class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#analyzing-the-source-code aria-label=Anchor>#</a></span></h2><h3 class="relative group"><strong><code>Setup.sol</code></strong><div id=setupsol class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#setupsol aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: MIT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>pragma solidity</span> <span class=o>^</span><span class=mi>0</span><span class=p>.</span><span class=mi>8</span><span class=p>.</span><span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>{</span> <span class=n>Stargazer</span> <span class=p>}</span> <span class=k>from</span> <span class=s>&#34;./Stargazer.sol&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>{</span> <span class=n>StargazerKernel</span> <span class=p>}</span> <span class=k>from</span> <span class=s>&#34;./StargazerKernel.sol&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>contract</span> <span class=nc>Setup</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Stargazer</span> <span class=k>public</span> <span class=k>immutable</span> <span class=n>TARGET_PROXY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>StargazerKernel</span> <span class=k>public</span> <span class=k>immutable</span> <span class=n>TARGET_IMPL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>event</span> <span class=nc>DeployedTarget</span><span class=p>(</span><span class=kt>address</span> <span class=n>proxy</span><span class=p>,</span> <span class=kt>address</span> <span class=n>implementation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>constructor</span><span class=p>(</span><span class=kt>bytes</span> <span class=k>memory</span> <span class=n>signature</span><span class=p>)</span> <span class=k>payable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>TARGET_IMPL</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StargazerKernel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>string</span><span class=p>[]</span> <span class=k>memory</span> <span class=n>starNames</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>string</span><span class=p>[](</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>starNames</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;Nova-GLIM_007&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>initializeCall</span> <span class=o>=</span> <span class=nb>abi</span><span class=p>.</span><span class=n>encodeCall</span><span class=p>(</span><span class=n>TARGET_IMPL</span><span class=p>.</span><span class=n>initialize</span><span class=p>,</span> <span class=n>starNames</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>TARGET_PROXY</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Stargazer</span><span class=p>(</span><span class=kt>address</span><span class=p>(</span><span class=n>TARGET_IMPL</span><span class=p>),</span> <span class=n>initializeCall</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>createPASKATicketCall</span> <span class=o>=</span> <span class=nb>abi</span><span class=p>.</span><span class=n>encodeCall</span><span class=p>(</span><span class=n>TARGET_IMPL</span><span class=p>.</span><span class=n>createPASKATicket</span><span class=p>,</span> <span class=p>(</span><span class=n>signature</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=kt>bool</span> <span class=n>success</span><span class=p>,</span> <span class=p>)</span> <span class=o>=</span> <span class=kt>address</span><span class=p>(</span><span class=n>TARGET_PROXY</span><span class=p>).</span><span class=nb>call</span><span class=p>(</span><span class=n>createPASKATicketCall</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>success</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=k>memory</span> <span class=n>starName</span> <span class=o>=</span> <span class=s>&#34;Starry-SPURR_001&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>commitStarSightingCall</span> <span class=o>=</span> <span class=nb>abi</span><span class=p>.</span><span class=n>encodeCall</span><span class=p>(</span><span class=n>TARGET_IMPL</span><span class=p>.</span><span class=n>commitStarSighting</span><span class=p>,</span> <span class=p>(</span><span class=n>starName</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>success</span><span class=p>,</span> <span class=p>)</span> <span class=o>=</span> <span class=kt>address</span><span class=p>(</span><span class=n>TARGET_PROXY</span><span class=p>).</span><span class=nb>call</span><span class=p>(</span><span class=n>commitStarSightingCall</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>success</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>emit</span> <span class=n>DeployedTarget</span><span class=p>(</span><span class=kt>address</span><span class=p>(</span><span class=n>TARGET_PROXY</span><span class=p>),</span> <span class=kt>address</span><span class=p>(</span><span class=n>TARGET_IMPL</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>isSolved</span><span class=p>()</span> <span class=k>public</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=n>success</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>getStarSightingsCall</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>returnData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>getStarSightingsCall</span> <span class=o>=</span> <span class=nb>abi</span><span class=p>.</span><span class=n>encodeCall</span><span class=p>(</span><span class=n>TARGET_IMPL</span><span class=p>.</span><span class=n>getStarSightings</span><span class=p>,</span> <span class=p>(</span><span class=s>&#34;Nova-GLIM_007&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>success</span><span class=p>,</span> <span class=n>returnData</span><span class=p>)</span> <span class=o>=</span> <span class=kt>address</span><span class=p>(</span><span class=n>TARGET_PROXY</span><span class=p>).</span><span class=nb>call</span><span class=p>(</span><span class=n>getStarSightingsCall</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>success</span><span class=p>,</span> <span class=s>&#34;Setup: failed external call.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span><span class=p>[]</span> <span class=k>memory</span> <span class=n>novaSightings</span> <span class=o>=</span> <span class=nb>abi</span><span class=p>.</span><span class=nb>decode</span><span class=p>(</span><span class=n>returnData</span><span class=p>,</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>[]));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>getStarSightingsCall</span> <span class=o>=</span> <span class=nb>abi</span><span class=p>.</span><span class=n>encodeCall</span><span class=p>(</span><span class=n>TARGET_IMPL</span><span class=p>.</span><span class=n>getStarSightings</span><span class=p>,</span> <span class=p>(</span><span class=s>&#34;Starry-SPURR_001&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=n>success</span><span class=p>,</span> <span class=n>returnData</span><span class=p>)</span> <span class=o>=</span> <span class=kt>address</span><span class=p>(</span><span class=n>TARGET_PROXY</span><span class=p>).</span><span class=nb>call</span><span class=p>(</span><span class=n>getStarSightingsCall</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>success</span><span class=p>,</span> <span class=s>&#34;Setup: failed external call.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span><span class=p>[]</span> <span class=k>memory</span> <span class=n>starrySightings</span> <span class=o>=</span> <span class=nb>abi</span><span class=p>.</span><span class=nb>decode</span><span class=p>(</span><span class=n>returnData</span><span class=p>,</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>[]));</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>novaSightings</span><span class=p>.</span><span class=n>length</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=n>starrySightings</span><span class=p>.</span><span class=n>length</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The Setup contract is more complex than usual. Although the complexity was added by the fact that the target contract is an upgradable contract, meaning that raw calls need to be made to interact with the proxy and the underlying implementation contract.<br>The setup involves deploying the implementation code, initializing it, calling an authorized function and passing to it a valid signature. The implementation address is finally set in the proxy contract.</p><p>In order to solve this challenge, we need to &ldquo;override&rdquo; the Stargazer &ldquo;memory&rdquo; and make it believe the past sightings of the stars &ldquo;<em>Nova-GLIM_007</em>&rdquo; and &ldquo;<em>Starry-SPURR_001</em>&rdquo;, are actually a recurrent event and that it&rsquo;s the second time he&rsquo;s seeing them.<br>In other words, the Stargazer mapping that maps a <code>starId</code> to their number of occurrences, which must be greater than <code>1</code> for both stars.</p><h3 class="relative group"><strong><code>Stargazer.sol</code></strong><div id=stargazersol class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#stargazersol aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: MIT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>pragma solidity</span> <span class=o>^</span><span class=mi>0</span><span class=p>.</span><span class=mi>8</span><span class=p>.</span><span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;@openzeppelin/contracts/proxy/ERC1967/ERC1967Proxy.sol&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>contract</span> <span class=nc>Stargazer</span> <span class=k>is</span> <span class=n>ERC1967Proxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>constructor</span><span class=p>(</span><span class=kt>address</span> <span class=n>_implementation</span><span class=p>,</span> <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>_data</span><span class=p>)</span> <span class=n>ERC1967Proxy</span><span class=p>(</span><span class=n>_implementation</span><span class=p>,</span> <span class=n>_data</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**************************************************************************
</span></span></span><span class=line><span class=cl><span class=cm>    a lonely machine in a lonely world looking a lonely shooting star...   
</span></span></span><span class=line><span class=cl><span class=cm>***************************************************************************
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â Ÿâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¿â †â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£­â¡†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¹â „â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â „â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£€â£€â£¤â ¤â¢¤â£€â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¸â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â£ â ´â ’â¢‹â£‰â£€â£ â£„â£€â£ˆâ¡‡â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¸â¡†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£ â£´â£¾â£¯â ´â šâ ‰â ‰â €â €â €â €â£¤â â£¿â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡¿â¡‡â â €â €â €â €â¡„â €â €â €â €â €â €â €â €â£ â£´â¡¿â ¿â¢›â â â£¸â €â €â €â €â €â£¤â£¾â µâ šâ â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â °â¢¦â¡€â €â£ â €â¡‡â¢§â €â €â¢€â£ â¡¾â¡‡â €â €â €â €â €â£ â£´â ¿â ‹â â €â €â €â €â ˜â£¿â €â£€â¡ â žâ ›â â ‚â â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡ˆâ£»â¡¦â£žâ¡¿â£·â ¸â£„â£¡â¢¾â¡¿â â €â €â €â£€â£´â Ÿâ ‹â â €â €â €â €â â  â¡¤â£¾â£™â£¶â¡¶â ƒâ €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£‚â¡·â °â£”â£¾â£–â£¾â¡·â¢¿â£â£€â£€â£¤â¢¾â£‹â â €â €â €â£€â¢€â£€â£€â£€â£€â €â¢€â¢¿â ‘â ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â  â¡¦â ´â ´â ¤â ¦â ¤â ¤â ¤â ¤â ¤â ´â ¶â¢¾â£½â£™â ’â¢ºâ£¿â£¿â£¿â£¿â¢¾â ¶â£§â¡¼â¢â ‘â šâ ‹â ‰â ‰â¡‰â¡‰â ‰â ‰â ¹â ˆâ â ‰â €â ¨â¢¾â¡‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â ‚â €â €â €â ‚â â €â €â €â ˆâ£‡â¡¿â¢¯â¢»â£Ÿâ£‡â£·â£žâ¡›â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£€â£ â£†â €â €â €â €â¢ â¡·â¡›â£›â£¼â£¿â Ÿâ ™â£§â …â¡„â €â €â €â €â €â €â °â¡†â €â €â €â €â¢ â£¾â¡„â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â£€â£´â¢¶â â ‰â €â €â €â €â €â ¿â¢ â£´â¡Ÿâ¡—â¡¾â¡’â –â ‰â â â €â €â €â €â£€â¢€â£ â£§â£€â£€â €â €â €â šâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â£ â¢´â£¿â Ÿâ â €â €â €â €â €â €â €â£ â£·â¢¿â ‹â â£¿â¡â …â €â €â €â €â €â €â €â €â €â ˆâ ™â£¿â¢­â ‰â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â¢€â¡´â¢â¡µâ ›â €â €â €â €â €â €â €â£€â£´â žâ ›â €â €â €â €â¢¿â €â ‚â €â €â €â €â €â €â €â €â €â €â ‚â¢¿â ˜â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â£€â£¼â ›â£²â¡â â €â €â €â €â €â¢€â£ â¡¾â ‹â ‰â €â €â €â €â €â €â¢¾â¡…â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â¡´â Ÿâ €â¢°â¡¯â „â €â €â €â €â£ â¢´â Ÿâ ‰â €â €â €â €â €â €â €â €â €â£¹â †â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â¡¾â â â €â ˜â §â ¤â¢¤â£¤â ¶â â ™â €â €â €â €â €â €â €â €â €â €â €â €â¢¾â¡ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â ˜â£‡â ‚â¢€â£€â£€â ¤â žâ ‹â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£¼â ‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â ˆâ ‰â ‰â ‰â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¾â¡‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¼â¡†â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢°â¡‡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ ›â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
</span></span></span><span class=line><span class=cl><span class=cm>***************************************************************************
</span></span></span><span class=line><span class=cl><span class=cm>    ...wondering if it will get the chance to witness it again.            
</span></span></span><span class=line><span class=cl><span class=cm>**************************************************************************/</span>
</span></span></code></pre></div><p>The <code>Stargazer</code> contract implements the ERC1967 standard from the OpenZeppelin upgradable contracts collection.<br>The <a href=https://eips.ethereum.org/EIPS/eip-1967 target=_blank>ERC-1967 standard</a> defines a consistent pattern for upgradable contracts by using two contracts with different purposes. The only functionality of the first contract, known as the proxy contract, is to hold the contract storage. The proxy storage holds the address where the logic of the contract is implemented, known as the implementation contract. The proxy contract receives function calls and proxies them to the logic contract using <code>delegatecall</code>. The use of the <code>delegatecall</code> instruction is the key because it allows the implementation contract to execute code using the proxy storage. The ability to just point to another address for the implementation in the proxy contract, make this pattern &ldquo;upgradable&rdquo;.<br>The standard is being used by the UUPS (Universal Upgradeable Proxy Standard) and the Transparent Upgradeable Proxy Pattern. As we&rsquo;ll see later, that challenge is based on the UUPS pattern.<br>In the end, the <code>Stargazer</code> contract is just an OpenZeppelin implementation of ERC-1967, with a cool ascii art.</p><h3 class="relative group"><strong><code>StargazerKernel.sol</code></strong><div id=stargazerkernelsol class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#stargazerkernelsol aria-label=Anchor>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=c1>// SPDX-License-Identifier: MIT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>pragma solidity</span> <span class=o>^</span><span class=mi>0</span><span class=p>.</span><span class=mi>8</span><span class=p>.</span><span class=mi>20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;@openzeppelin/contracts-upgradeable/proxy/utils/UUPSUpgradeable.sol&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>contract</span> <span class=nc>StargazerKernel</span> <span class=k>is</span> <span class=n>UUPSUpgradeable</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// keccak256(abi.encode(uint256(keccak256(&#34;htb.storage.Stargazer&#34;)) - 1)) &amp; ~bytes32(uint256(0xff));
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>bytes32</span> <span class=k>private</span> <span class=k>constant</span> <span class=n>__STARGAZER_MEMORIES_LOCATION</span> <span class=o>=</span> <span class=mh>0x8e8af00ddb7b2dfef2ccc4890803445639c579a87f9cda7f6886f80281e2c800</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>/// @custom:storage-location erc7201:htb.storage.Stargazer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>struct</span> <span class=nc>StargazerMemories</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span> <span class=n>originTimestamp</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=kd>mapping</span><span class=p>(</span><span class=kt>bytes32</span> <span class=o>=&gt;</span> <span class=kt>uint256</span><span class=p>[])</span> <span class=n>starSightings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>mapping</span><span class=p>(</span><span class=kt>bytes32</span> <span class=o>=&gt;</span> <span class=kt>bool</span><span class=p>)</span> <span class=n>usedPASKATickets</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>mapping</span><span class=p>(</span><span class=kt>address</span> <span class=o>=&gt;</span> <span class=n>KernelMaintainer</span><span class=p>)</span> <span class=n>kernelMaintainers</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>struct</span> <span class=nc>KernelMaintainer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>address</span> <span class=n>account</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>PASKATicket</span><span class=p>[]</span> <span class=n>PASKATickets</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span> <span class=n>PASKATicketsNonce</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>struct</span> <span class=nc>PASKATicket</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>hashedRequest</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes</span> <span class=n>signature</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>event</span> <span class=nc>PASKATicketCreated</span><span class=p>(</span><span class=n>PASKATicket</span> <span class=n>ticket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>event</span> <span class=nc>StarSightingRecorded</span><span class=p>(</span><span class=kt>string</span> <span class=n>starName</span><span class=p>,</span> <span class=kt>uint256</span> <span class=n>sightingTimestamp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>event</span> <span class=nc>AuthorizedKernelUpgrade</span><span class=p>(</span><span class=kt>address</span> <span class=n>newImplementation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>initialize</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=k>memory</span> <span class=n>_pastStarSightings</span><span class=p>)</span> <span class=k>public</span> <span class=n>initializer</span> <span class=n>onlyProxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>.</span><span class=n>originTimestamp</span> <span class=o>=</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>.</span><span class=n>kernelMaintainers</span><span class=p>[</span><span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>].</span><span class=n>account</span> <span class=o>=</span> <span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>uint256</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>_pastStarSightings</span><span class=p>.</span><span class=n>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>bytes32</span> <span class=n>starId</span> <span class=o>=</span> <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encodePacked</span><span class=p>(</span><span class=n>_pastStarSightings</span><span class=p>[</span><span class=n>i</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>            <span class=err>$</span><span class=p>.</span><span class=n>starSightings</span><span class=p>[</span><span class=n>starId</span><span class=p>].</span><span class=n>push</span><span class=p>(</span><span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>createPASKATicket</span><span class=p>(</span><span class=kt>bytes</span> <span class=k>memory</span> <span class=n>_signature</span><span class=p>)</span> <span class=k>public</span> <span class=n>onlyProxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span> <span class=n>nonce</span> <span class=o>=</span> <span class=err>$</span><span class=p>.</span><span class=n>kernelMaintainers</span><span class=p>[</span><span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>].</span><span class=n>PASKATicketsNonce</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>hashedRequest</span> <span class=o>=</span> <span class=n>_prefixed</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encodePacked</span><span class=p>(</span><span class=s>&#34;PASKA: Privileged Authorized StargazerKernel Action&#34;</span><span class=p>,</span> <span class=n>nonce</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>PASKATicket</span> <span class=k>memory</span> <span class=n>newTicket</span> <span class=o>=</span> <span class=n>PASKATicket</span><span class=p>(</span><span class=n>hashedRequest</span><span class=p>,</span> <span class=n>_signature</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>_verifyPASKATicket</span><span class=p>(</span><span class=n>newTicket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>.</span><span class=n>kernelMaintainers</span><span class=p>[</span><span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>].</span><span class=n>PASKATickets</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>newTicket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>.</span><span class=n>kernelMaintainers</span><span class=p>[</span><span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>].</span><span class=n>PASKATicketsNonce</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>emit</span> <span class=n>PASKATicketCreated</span><span class=p>(</span><span class=n>newTicket</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>commitStarSighting</span><span class=p>(</span><span class=kt>string</span> <span class=k>memory</span> <span class=n>_starName</span><span class=p>)</span> <span class=k>public</span> <span class=n>onlyProxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>address</span> <span class=n>author</span> <span class=o>=</span> <span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>PASKATicket</span> <span class=k>memory</span> <span class=n>starSightingCommitRequest</span> <span class=o>=</span> <span class=n>_consumePASKATicket</span><span class=p>(</span><span class=n>author</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>starId</span> <span class=o>=</span> <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encodePacked</span><span class=p>(</span><span class=n>_starName</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span> <span class=n>sightingTimestamp</span> <span class=o>=</span> <span class=nb>block</span><span class=p>.</span><span class=nb>timestamp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>.</span><span class=n>starSightings</span><span class=p>[</span><span class=n>starId</span><span class=p>].</span><span class=n>push</span><span class=p>(</span><span class=n>sightingTimestamp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>emit</span> <span class=n>StarSightingRecorded</span><span class=p>(</span><span class=n>_starName</span><span class=p>,</span> <span class=n>sightingTimestamp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>getStarSightings</span><span class=p>(</span><span class=kt>string</span> <span class=k>memory</span> <span class=n>_starName</span><span class=p>)</span> <span class=k>public</span> <span class=k>view</span> <span class=n>onlyProxy</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>uint256</span><span class=p>[]</span> <span class=k>memory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>starId</span> <span class=o>=</span> <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encodePacked</span><span class=p>(</span><span class=n>_starName</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=err>$</span><span class=p>.</span><span class=n>starSightings</span><span class=p>[</span><span class=n>starId</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>_getStargazerMemory</span><span class=p>()</span> <span class=k>private</span> <span class=k>view</span> <span class=n>onlyProxy</span> <span class=k>returns</span> <span class=p>(</span><span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>assembly</span> { <span class=err>$</span><span class=p>.</span><span class=n>slot</span> <span class=o>:=</span> <span class=n>__STARGAZER_MEMORIES_LOCATION</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>_getKernelMaintainerInfo</span><span class=p>(</span><span class=kt>address</span> <span class=n>_kernelMaintainer</span><span class=p>)</span> <span class=k>internal</span> <span class=k>view</span> <span class=n>onlyProxy</span> <span class=k>returns</span> <span class=p>(</span><span class=n>KernelMaintainer</span> <span class=k>memory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=err>$</span><span class=p>.</span><span class=n>kernelMaintainers</span><span class=p>[</span><span class=n>_kernelMaintainer</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>_authorizeUpgrade</span><span class=p>(</span><span class=kt>address</span> <span class=n>_newImplementation</span><span class=p>)</span> <span class=k>internal</span> <span class=k>override</span> <span class=n>onlyProxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>address</span> <span class=n>issuer</span> <span class=o>=</span> <span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>PASKATicket</span> <span class=k>memory</span> <span class=n>kernelUpdateRequest</span> <span class=o>=</span> <span class=n>_consumePASKATicket</span><span class=p>(</span><span class=n>issuer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>emit</span> <span class=n>AuthorizedKernelUpgrade</span><span class=p>(</span><span class=n>_newImplementation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>_consumePASKATicket</span><span class=p>(</span><span class=kt>address</span> <span class=n>_kernelMaintainer</span><span class=p>)</span> <span class=k>internal</span> <span class=n>onlyProxy</span> <span class=k>returns</span> <span class=p>(</span><span class=n>PASKATicket</span> <span class=k>memory</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>KernelMaintainer</span> <span class=k>storage</span> <span class=n>maintainer</span> <span class=o>=</span> <span class=err>$</span><span class=p>.</span><span class=n>kernelMaintainers</span><span class=p>[</span><span class=n>_kernelMaintainer</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>PASKATicket</span><span class=p>[]</span> <span class=k>storage</span> <span class=n>activePASKATickets</span> <span class=o>=</span> <span class=n>maintainer</span><span class=p>.</span><span class=n>PASKATickets</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>activePASKATickets</span><span class=p>.</span><span class=n>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;StargazerKernel: no active PASKA tickets.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>PASKATicket</span> <span class=k>memory</span> <span class=n>ticket</span> <span class=o>=</span> <span class=n>activePASKATickets</span><span class=p>[</span><span class=n>activePASKATickets</span><span class=p>.</span><span class=n>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>ticketId</span> <span class=o>=</span> <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encode</span><span class=p>(</span><span class=n>ticket</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=err>$</span><span class=p>.</span><span class=n>usedPASKATickets</span><span class=p>[</span><span class=n>ticketId</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>activePASKATickets</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ticket</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>_verifyPASKATicket</span><span class=p>(</span><span class=n>PASKATicket</span> <span class=k>memory</span> <span class=n>_ticket</span><span class=p>)</span> <span class=k>internal</span> <span class=k>view</span> <span class=n>onlyProxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>address</span> <span class=n>signer</span> <span class=o>=</span> <span class=n>_recoverSigner</span><span class=p>(</span><span class=n>_ticket</span><span class=p>.</span><span class=n>hashedRequest</span><span class=p>,</span> <span class=n>_ticket</span><span class=p>.</span><span class=n>signature</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>_isKernelMaintainer</span><span class=p>(</span><span class=n>signer</span><span class=p>),</span> <span class=s>&#34;StargazerKernel: signer is not a StargazerKernel maintainer.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>ticketId</span> <span class=o>=</span> <span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encode</span><span class=p>(</span><span class=n>_ticket</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=o>!</span><span class=err>$</span><span class=p>.</span><span class=n>usedPASKATickets</span><span class=p>[</span><span class=n>ticketId</span><span class=p>],</span> <span class=s>&#34;StargazerKernel: PASKA ticket already used.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nf>_recoverSigner</span><span class=p>(</span><span class=kt>bytes32</span> <span class=n>_message</span><span class=p>,</span> <span class=kt>bytes</span> <span class=k>memory</span> <span class=n>_signature</span><span class=p>)</span> <span class=k>internal</span> <span class=k>view</span> <span class=n>onlyProxy</span> <span class=k>returns</span> <span class=p>(</span><span class=kt>address</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>require</span><span class=p>(</span><span class=n>_signature</span><span class=p>.</span><span class=n>length</span> <span class=o>==</span> <span class=mi>65</span><span class=p>,</span> <span class=s>&#34;StargazerKernel: invalid signature length.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>bytes32</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint8</span> <span class=n>v</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>assembly</span> (<span class=s>&#34;memory-safe&#34;) {
</span></span></span><span class=line><span class=cl><span class=s>            r := mload(add(_signature, 0x20))
</span></span></span><span class=line><span class=cl><span class=s>            s := mload(add(_signature, 0x40))
</span></span></span><span class=line><span class=cl><span class=s>            v := byte(0, mload(add(_signature, 0x60)))
</span></span></span><span class=line><span class=cl><span class=s>        }
</span></span></span><span class=line><span class=cl><span class=s>        require(v == 27 || v == 28, &#34;StargazerKernel: invalid signature version&#34;);
</span></span></span><span class=line><span class=cl><span class=s>        address signer = ecrecover(_message, v, r, s);
</span></span></span><span class=line><span class=cl><span class=s>        require(signer != address(0), &#34;StargazerKernel: invalid signature.&#34;);
</span></span></span><span class=line><span class=cl><span class=s>        return signer;
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    function _isKernelMaintainer(address _account) internal view onlyProxy returns (bool) {
</span></span></span><span class=line><span class=cl><span class=s>        StargazerMemories storage $ = _getStargazerMemory();
</span></span></span><span class=line><span class=cl><span class=s>        return $.kernelMaintainers[_account].account == _account;
</span></span></span><span class=line><span class=cl><span class=s>    }
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>    function _prefixed(bytes32 hash) internal pure returns (bytes32</span>) {
</span></span><span class=line><span class=cl>        <span class=nf>return</span> <span class=nf>keccak256</span><span class=p>(</span><span class=n>abi</span><span class=p>.</span><span class=n>encodePacked</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\x19</span><span class=s>Ethereum Signed Message:</span><span class=se>\n</span><span class=s>32&#34;</span><span class=p>,</span> <span class=n>hash</span><span class=p>))</span><span class=err>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The logic implementation of the contract provides a wide set of functionalities, so we need to start analyzing them.
First of all, the contract inherit from <a href=https://docs.openzeppelin.com/contracts/5.x/api/proxy#UUPSUpgradeable target=_blank>OpenZeppelin V5 UUPSUpgradeable implementation</a>. That means the contract will expose implicitly some functions and modifiers.<br>For example, the <code>onlyProxy()</code> modifier, that ensures (where applied) that functions calls are proxied, and not directly sent to the implementation contract.<br>It also expose an important overridable function: <code>_authorizeUpgrade</code>. That function must be overridden and implemented in the contract, and it&rsquo;s the key function that authorizes upgrades. In our case, to pass an upgrade request, the only requirement is that the call is proxied and that <code>_consumePASKATicket</code> internal function should not revert.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>function</span> <span class=nf>_authorizeUpgrade</span><span class=p>(</span><span class=kt>address</span> <span class=n>_newImplementation</span><span class=p>)</span> <span class=k>internal</span> <span class=k>override</span> <span class=n>onlyProxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>address</span> <span class=n>issuer</span> <span class=o>=</span> <span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PASKATicket</span> <span class=k>memory</span> <span class=n>kernelUpdateRequest</span> <span class=o>=</span> <span class=n>_consumePASKATicket</span><span class=p>(</span><span class=n>issuer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>emit</span> <span class=n>AuthorizedKernelUpgrade</span><span class=p>(</span><span class=n>_newImplementation</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Another important function exposed implicitly in <code>StargazerKernel</code> is <a href=https://docs.openzeppelin.com/contracts/5.x/api/proxy#UUPSUpgradeable-upgradeToAndCall-address-bytes- target=_blank><code>upgradeToAndCall</code></a> which is the function that needs to be called to initiate a contract upgrade, common in many different OZ proxy pattern implementations.<br>In fact, reading the documentation and code of OpenZeppelin implementations is a must to fully understand the functionality of the smart contract. Furthermore, a fundamental requirement is to understand the basic mechanisms of an UUPS pattern, which have already been partly explained but can be explored in more detail from this recent excellent <a href=https://www.rareskills.io/post/uups-proxy target=_blank>blog post</a> by RareSkills.</p><p>Finally, one last standard that is helpful to read is <a href=https://eips.ethereum.org/EIPS/eip-7201 target=_blank>ERC-7201</a>. This implementation of UUPS in fact make use of the concept of &ldquo;<em>Namespaced Storage Layout</em>&rdquo; to overcome some known problems of proxy patterns, such as <strong>storage collision</strong>. ERC-7201 solves these problems, initializing all the state variables of the contract inside a struct that is saved to a storage pointer defined by the following formula:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=nb>keccak256</span><span class=p>(</span><span class=nb>abi</span><span class=p>.</span><span class=nb>encode</span><span class=p>(</span><span class=kt>uint256</span><span class=p>(</span><span class=nb>keccak256</span><span class=p>(</span><span class=s>&#34;htb.storage.Stargazer&#34;</span><span class=p>))</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span> <span class=o>&amp;</span> <span class=o>~</span><span class=kt>bytes32</span><span class=p>(</span><span class=kt>uint256</span><span class=p>(</span><span class=mh>0xff</span><span class=p>))</span>
</span></span></code></pre></div><p>The meaning of this formula, and the reason for this choice and how it is useful for the implementations of upgradable contracts can be explored in depth in this other excellent <a href=https://www.rareskills.io/post/erc-7201 target=_blank>blog post</a> by RareSkills again.</p><p>After the initial ERC-hell we can dive into the core logic implemented in <code>StargazerKernel</code>:</p><ul><li><p><strong><code>initialize(string[] memory _pastStarSightings)</code></strong>: This is a base contract to aid in writing upgradeable contracts, or any kind of contract that will be deployed behind a proxy. Since proxied contracts do not make use of a constructor, itâ€™s common to move constructor logic to an external initializer function, usually called <code>initialize</code>. It then becomes necessary to protect this initializer function so it can only be called once. The <code>initializer</code> modifier provided by this contract will have this effect. This camouflaged constructor plays a very important role for these patterns. In fact, leaving the contract uninitialized opens up a huge security risk. However, this is not our case as the contract is initialized as soon as it gets created. In particular, our initialization function takes as input the string array <code>_pastStarSightings</code> to reconstruct the past memory of our &ldquo;<em>Stargazer</em>&rdquo;.</p></li><li><p><strong><code>_getStargazerMemory()</code></strong>: Every function that intends to access contract storage must comply with ERC-7201, which is why a utility function to quickly retrieve the correct storage pointer of the main storage is necessary. The intended storage pointer is the pre-calculated <code>__STARGAZER_MEMORIES_LOCATION</code> constant, which effectively points to the Stargazer &ldquo;memories&rdquo;.</p></li><li><p><strong><code>createPASKATicket(bytes memory _signature)</code></strong>: This is one of the crucial functionalities of the whole implementation. This function enables a <code>KernelMaintainer</code> to generate a new <code>PASKATicket</code> (<em>Privileged Authorized StargazerKernel Action Ticket</em>), which authorizes them to perform privileged actions such as upgrading the contract. A signature needs to be passed to it. The signature mechanism is presented as a 2FA-like structure, where only if a valid signature from an already registered <code>KernelMaintainer</code> is provided, then it will issue a valid <code>PASKATicket</code>. The signature mechanism uses <strong>per-user nonces</strong> and construct the message hash using <code>personal_sign</code> standart to avoid known <code>eth_sign</code> issues, like signature replay from a sent transaction. The signature validation is guaranteed by <code>_verifyPASKATicket</code> internal function. If that function does not revert, then a valid signature has been passed and a <code>PASKATicket</code> will be issued under an <code>PASKATickets[]</code> array inside the <code>KernelMaintainer</code> struct, and the maintainer nonce will be updated. <em><strong>NOTE</strong></em>: <em>while the per-user nonce model makes sense in both security and convenience sides, it plays a crucial role in making the exploitation possible. We will see why later</em>.</p></li><li><p><strong><code>_verifyPASKATicket(PASKATicket memory _ticket)</code></strong>: This internal view function validates the authenticity and uniqueness of a provided <code>PASKATicket</code>. The validation process calls <code>_recoverSigner</code> internal function that uses the widely known <code>ecrecover</code> pre-compile to extract the signer address from the provided signature. This function is widely known to have security concerns due to its low-level nature. In order to be used safely, some input and output validation needs to be done. The Solidity documentation hints to one of the major issues (see image below), i.e. signature malleability, however it doesn&rsquo;t provide further details. Details on how an unsafe <code>ecrecover</code> can open to security vulnerability can be read online, e.g. this <a href=https://scsfg.io/hackers/signature-attacks/ target=_blank>blog post</a>. The invalid signature length, zero address signer, <code>eth_sign</code> replay, signature deduplication, can be cancelled out in the possible exploits scenarios because checks are being made for these. One plausible concern can be made around <em><strong>Signature Malleability</strong></em>, since the recover function doesn&rsquo;t enforce the lower half ECDSA curve order for the <code>s</code> parameter. The issue is confirmed by how the signature &ldquo;bin&rdquo; for used signature is implemented. As stated <a href=https://github.com/kadenzipfel/smart-contract-vulnerabilities/blob/master/vulnerabilities/signature-malleability.md target=_blank>here</a> if used signatures are tracked by reliying only on the signature bytes, then another valid, but different, signature of the same action by the same address can be used to bypass the mechanism and open to <em><strong>Signature Replay Attack</strong></em>. We will dive into that later.</p></li></ul><p><figure><img class="my-0 rounded-md" loading=lazy src=./assets/ecrecover_solidity_doc.png alt></figure></p><ul><li><p><strong><code>_consumePASKATicket(address _kernelMaintainer)</code></strong>: An internal function responsible for validating and consuming a PASKATicket associated with a KernelMaintainer. It accesses the maintainer&rsquo;s active <code>PASKATickets</code> and ensures that at least one ticket exists. If yes, the ticket is popped from the list of available tickets and gets trashed inside the <code>usedPASKATickets</code> array.</p></li><li><p><strong><code>commitStarSighting(string memory _starName)</code></strong>: This function records a new sighting of a specified star, updating the <code>starSightings</code> mapping, which is of our interest. Since it consumes a <code>PASKATicket</code>, in order to commit a new star sighting, the function call must be initiated from a registered <code>KernelMaintainer</code> with some valid (already issued) <code>PASKATicket</code> ready to be consumed.</p></li><li><p><strong><code>getStarSightings(string memory _starName)</code></strong>: A view function that allows users to query all recorded sightings of a particular star.</p></li><li><p><strong><code>_getKernelMaintainerInfo(address _kernelMaintainer)</code></strong>: An internal function that fetches the KernelMaintainer struct associated with a specific address. This provides access to the maintainer&rsquo;s account details, active PASKATickets, and nonce, facilitating authorization and tracking of privileged actions.</p></li><li><p><strong><code>_isKernelMaintainer(address _account)</code></strong>: An internal view function that checks whether a given address is an authorized registered KernelMaintainer.</p></li><li><p><strong><code>_prefixed(bytes32 hash)</code></strong>: An internal pure function that prefixes a given hash with the Ethereum signed message prefix, following the <code>personal_sign</code> standard.</p></li></ul><p>At this point we have come down to the point where we know the contract is vulnerable to Signature Malleability, but we still don&rsquo;t know how to retrieve a valid signature of a registered <code>KernelMaintainer</code> and impersonate him.<br>For the first part we have the easy solution, remembering that during the initialization phase, in the <code>Setup</code> contract, a signature was signed to call <code>commitStarSighting</code> and record sightings of the two stars. That signature is valid, since the same signer is added to the <code>KernelMaintainers</code> during initialization by the <code>initialize</code> function (L36).</p><p>At this point there are two details that could block most players.</p><ol><li>Even if we managed to exploit a signature and manage to replicate one, to commit a new sighting of one of the two stars, it would be necessary to find another valid signature because with this attack each signature can be replayed maximum one more time. However, only one <code>PASKATicket</code> was created at initialization so we should find another way.</li><li>Even if we managed to find a way to sign arbitrary <code>PASKATickets</code>, we must remember that the signature created is based on the <code>KernelMaintainer</code>&rsquo;s nonce, which means that we certainly could not replicate the privileged action signed by the <code>KernelMaintainer</code> with the given nonce more than once <code>n</code>. Furthermore, the player is not a registered <code>KernelMaintainer</code> and consequently will not have its own nonces tracked either.</li></ol><p>However, some important details can make our exploit possible despite these constraints.<br>First of all, the fundamental intuition must be that there is no distinction between the various PASKA Actions, which means that <strong>a valid <code>PASKATicket</code> valid for example for calling <code>commitStarSighting</code> will also be valid for other privileged functions</strong>.<br>What are the other actions that require consuming a <code>PASKATicket</code>? The <code>_authorizeUpgrade</code> function! That means we don&rsquo;t need to craft arbitrary signatures for $n$ <code>PASKATickets</code>, but we just need one valid <code>PASKATicket</code> signed from a <code>KernelMaintainer</code> to be able to upgrade the implementation contract and rewrite the logic and storage as we want.</p><p>A final important consideration can be seen in this code snippet:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-solidity data-lang=solidity><span class=line><span class=cl><span class=kd>function</span> <span class=nf>createPASKATicket</span><span class=p>(</span><span class=kt>bytes</span> <span class=k>memory</span> <span class=n>_signature</span><span class=p>)</span> <span class=k>public</span> <span class=n>onlyProxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StargazerMemories</span> <span class=k>storage</span> <span class=err>$</span> <span class=o>=</span> <span class=n>_getStargazerMemory</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint256</span> <span class=n>nonce</span> <span class=o>=</span> <span class=err>$</span><span class=p>.</span><span class=n>kernelMaintainers</span><span class=p>[</span><span class=nb>tx</span><span class=p>.</span><span class=nb>origin</span><span class=p>].</span><span class=n>PASKATicketsNonce</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>[...]</span>
</span></span></code></pre></div><p>Any users can request a <code>PASKATicket</code> creation, and when <code>$.kernelMaintainers[tx.origin].PASKATicketsNonce</code> will be evaluated with an address not being part of the registered <code>kernelMaintainers</code>, it will try to fetch <strong>uninitialized storage pointer</strong> that will automatically returns <code>0</code>. <em>That means, even though the player is not part of <code>kernelMaintainers</code>, it can temporarily impersonate one, by replaying the first <code>PASKATicket</code> of every <code>KernelMaintainer</code> since the first valid ticket for any maintainer will also have nonce <code>0</code>!</em><br>Furthermore, once the signature checks have been passed, no further checks are made on the address issuing the request for a <code>PASKATicket</code>, effectively creating a valid entry for the address of the player, despite not being part of <code>kernelMaintainers</code>.</p><h2 class="relative group">Exploitation<div id=exploitation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#exploitation aria-label=Anchor>#</a></span></h2><p>A successful exploit scenario will be the following:</p><ol><li>KernelMaintainer Bob initializes the <code>StargazerKernel</code> contract.</li><li>KernelMaintainer Bob signs and create a valid <code>PASKATicket</code> with nonce <code>0</code>.</li><li>KernelMaintainer Bob consumes <code>PASKATicket</code> with nonce <code>0</code> to commit a star sighting.</li><li>Attacker recovers the issued signature and malleate it. The malleability is possible because on ECDSA a given $\text{sig}_1 = (r,s,v)$ and $\text{sig}_2 = (r,s&rsquo;,v)$ where $s&rsquo;$ is calculated as $s&rsquo; = (-s \mod n)$, will share the same $x$ coordinate, meaning that a replay attack for that tuple <code>(signer, sig1)</code> is possible.</li><li>The vulnerable <code>StargazerKernel</code> allows creating a valid <code>PASKATicket</code> with the malleated signature, under the name of Attacker. The <code>PASKATicket</code> will be valid despite the fact that Attacker not being a <code>KernelMaintainer</code> because an uninitialized pointer will result in nonce <code>0</code> for the ticket (same as the first ticker of KernelMaintainer Bob).</li><li>Attacker can now upgrade implementation contract to a contract under his control by calling <code>upgradeToAndCall</code>. The new malicious contract must be a valid UUPS contract because of the <a href=https://docs.openzeppelin.com/contracts/4.x/api/proxy#UUPSUpgradeable-proxiableUUID-- target=_blank><code>proxiableUUID()</code></a> check being made from OpenZeppelin <code>upgradeToAndCall</code> function implementation.</li><li>Attacker can rewrite the storage as he wishes, because the proxy contract <code>Stargazer</code> will <code>delegatecall</code> to the evil attacker implementation contract.</li></ol><p>See the full exploitation script <a href=./htb/solver.py>here</a>.</p><hr><blockquote><p>HTB{stargazer_f1nds_s0l4c3_ag41n}</p></blockquote></div></div><script>var oid="views_posts/HTB-UniversityCTF-2024/Stargazer/index.md",oid_likes="likes_posts/HTB-UniversityCTF-2024/Stargazer/index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/htb-universityctf-2024/frontiermarketplace/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">HTB University CTF 2024 - FrontierMarketplace [Author Writeup]</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2024-12-05T00:00:03+01:00>5 December 2024</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/irisctf-2025/webwebhookhook/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">IrisCTF 2025 - webwebhookhook</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-01-12T00:00:00+01:00>12 January 2025</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
simonedimaria</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://simonedimaria.xyz/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>